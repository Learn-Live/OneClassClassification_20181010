/usr/local/bin/python3.6 /Users/kunyang/PycharmProjects/anomaly_detection_20190611/autoencoder_main_20190612.py

@@@train and evaluate AE on SYNT: uSc1C1_z-score_20_14

Step 1. loading data...
2019-06-16 18:38:13.347759: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA

+Step 1-1. preprocessing data...
len(mu) = 0, len(d_std) = 0
the variance of the 18-th feature is 0.
the variance of the 21-th feature is 0.
**all_norm:77988, all_attack:74242
x_norm_train:(54591, 27), x_attack_train:0
x_norm_val:(7799, 27), x_attack_val:0
x_norm_test:(15598, 27), x_attack_test:(74242, 27)

Step 3. train and evaluate AE on case: uSc1C1_z-score_20_14

Step 3-1. train AE on case: uSc1C1_z-score_20_14
x_norm_train.shape: (54591, 27)
AE training for Case :  uSc1C1_z-score_20_14  =  256.0662410259247 s
Train Loss =  0.04987393786852942 model.metrics_names ['loss']
Validation Loss =  0.06120708361740929 model.metrics_names ['loss']
training_losses:{'val_loss': [0.29264339234893455, 0.20253692564386971, 0.17707068859911804, 0.15684189412521696, 0.15268077943361805, 0.13904258838860342, 0.1313153802765793, 0.125884630354433, 0.13277737522080535, 0.12690226823341802, 0.12444470595921411, 0.12063349939090791, 0.10752460006817914, 0.12068043922228544, 0.1068601178494703, 0.10131599417677337, 0.10105355895156737, 0.09842464533254862, 0.10206892373092145, 0.09601915752483432, 0.09453781230363469, 0.09363214932702141, 0.09198850235380046, 0.10275983112082143, 0.08394135317211923, 0.0819460510802045, 0.08036748778969642, 0.07964433943641416, 0.0772550727301285, 0.08182321780040365, 0.0839658193560113, 0.09165366246325723, 0.07575539074282163, 0.07664403236962035, 0.07522346205834564, 0.07724282546139655, 0.0712152241830345, 0.07387271204612006, 0.0690464035549719, 0.06398228913233217, 0.06926959423449333, 0.06832135912995337, 0.07096894204034754, 0.0693334256003764, 0.06585016917470274, 0.07207880812301966, 0.06926814040090544, 0.06765753302160961, 0.07427208821067964, 0.07181981507297555, 0.06665293015596965, 0.06264202520996427, 0.0854068677098606, 0.07108003799847142, 0.07274732519629476, 0.07716165406643534, 0.06295292075340803, 0.07447510914847681, 0.06511761799477617, 0.060584314321306884, 0.060821530327118734, 0.060867694016784366, 0.06200136441882145, 0.07409839197450654, 0.06378967973273111, 0.06598555291835077, 0.062476382511180095, 0.06646406883761957, 0.0621064291271755, 0.06463777130260225, 0.06546946460624041, 0.06430503476474633, 0.06341398556412589, 0.060156356111734414, 0.0577204195831025, 0.05879489294105095, 0.05651304475673652, 0.06203666275957293, 0.06335667828065697, 0.06064657677848196, 0.05970466928634181, 0.057643049199419275, 0.058788658745834305, 0.05547811715896007, 0.06061368318546168, 0.056657196289225255, 0.06259462375139858, 0.05977132858868279, 0.0601305387804796, 0.06222335991497062, 0.06096468693745726, 0.057176764804885656, 0.05587821929776595, 0.06388575421983705, 0.05514023744013122, 0.061248937007438636, 0.06030354270424227, 0.057618710311882725, 0.06187456035858768, 0.06120708361740929], 'loss': [0.6972193760898615, 0.23633712428144593, 0.18039035032776454, 0.15562931960116805, 0.14325676685928046, 0.13367585427459272, 0.12863958091451613, 0.12126838232186324, 0.11811041343399051, 0.11477182952008531, 0.11152204309098372, 0.10686082996896003, 0.1027033212141489, 0.10142144158150086, 0.0971739769757959, 0.09607277741009713, 0.09219502497874746, 0.09146957755722346, 0.08864965108285443, 0.08741881223487762, 0.0876914145453384, 0.08419597379055165, 0.08145150498060164, 0.0801116528629905, 0.0779540175014005, 0.07640052267765036, 0.07396641313760555, 0.07123710447824254, 0.07031696260803048, 0.07013368984432782, 0.06809686385629439, 0.06758302598288168, 0.06706627140922394, 0.065263546364338, 0.06584500407092123, 0.06473843473785841, 0.06421787762443847, 0.06309519694174208, 0.06306273458718215, 0.06147573114685346, 0.06220265098375518, 0.061779042022230994, 0.06101218599906143, 0.059943940448994315, 0.05994835873084022, 0.05889614832624339, 0.05895012639930665, 0.05822862731218633, 0.05744713983137507, 0.05817576770917007, 0.056276140274035644, 0.056766859967389095, 0.05581045088358172, 0.055663875805436545, 0.056020705949891995, 0.055968514919691535, 0.05505545996774381, 0.05495802584111388, 0.05477723356705056, 0.055086564505545284, 0.053749608611161036, 0.05426835322178048, 0.05321048920103495, 0.05370140434448614, 0.05353050226352926, 0.05270756946252283, 0.05283473818752888, 0.05273649168891602, 0.05211109872586331, 0.05201640183688869, 0.05140441569188548, 0.05209966115317092, 0.051653241562720165, 0.05097421612239456, 0.05126319997846099, 0.05113363660909787, 0.05050582917240411, 0.050312655445137994, 0.05102206051931181, 0.05136162880427677, 0.05052743207045248, 0.05033944085430344, 0.049853574119400314, 0.04985809305515625, 0.05005740535079694, 0.0492379229554483, 0.049696015038437076, 0.049285343623232725, 0.04934608607802414, 0.04919639219401994, 0.04881070264693611, 0.048318760907417865, 0.04776964679393009, 0.04784556604642443, 0.04852205162209353, 0.048378940430453925, 0.04742960140103057, 0.04787427151508434, 0.04723009773583993, 0.04795618579401684]}
optimal_thres_AE_val:0.7202037373398414, factor = 15, key = loss
Test AE on train set on case: uSc1C1_z-score_20_14
x_norm_train.shape: (54591, 27)
AE Test time for  uSc1C1_z-score_20_14  = :  0.5758130550384521
[[    0     0]
 [  696 53895]]
tpr (recall): 0, fnr: 0, fpr: 0.012749354289168544, tnr: 0.9872506457108314, acc: 0.9872506457108314

Step 3-2. evaluate AE on case: uSc1C1_z-score_20_14

1). evaluate AE on test set:
x_test.shape: (89840, 27), case: uSc1C1_z-score_20_14
optimal_thres_AE 0.7202037373398414 achieved from key=loss, factor = 15, key = loss
AE Test time for  uSc1C1_z-score_20_14  = :  1.0038039684295654
[[73001  1241]
 [  210 15388]]
tpr (recall): 0.9832843942781714, fnr: 0.016715605721828616, fpr: 0.013463264521092448, tnr: 0.9865367354789075, acc: 0.9838490650044524

save the FPR and FNR reausts of AE with num =27 features on test set.
output_pre_path:uSc1C1_z-score_20_14_recon_err_of_27_features
*the maximize reconstrcution error is 110.36700450575428 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C1_z-score_20_14_recon_err_of_27_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 110.36700450575428 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 137.39370742077895 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C1_z-score_20_14_recon_err_of_27_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 137.39370742077895 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 27 features.
*** thres = 0.011612517877256468
AE Test time for  uSc1C1_z-score_20_14  = :  1.0235381126403809
[[74242     0]
 [15598     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.826380231522707
*** thres = 0.08681225244580523
AE Test time for  uSc1C1_z-score_20_14  = :  1.0285301208496094
[[74242     0]
 [  915 14683]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.05866136684190281, tnr: 0.9413386331580972, acc: 0.9898152270703473
*** thres = 0.16201198701435401
AE Test time for  uSc1C1_z-score_20_14  = :  1.1261529922485352
[[74242     0]
 [  510 15088]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.032696499551224514, tnr: 0.9673035004487754, acc: 0.9943232413178985
*** thres = 0.23721172158290277
AE Test time for  uSc1C1_z-score_20_14  = :  1.096968173980713
[[74242     0]
 [  413 15185]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.026477753558148482, tnr: 0.9735222464418515, acc: 0.9954029385574354
*** thres = 0.31241145615145155
AE Test time for  uSc1C1_z-score_20_14  = :  1.076876163482666
[[74242     0]
 [  380 15218]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.024362097704833954, tnr: 0.975637902295166, acc: 0.9957702582368655
*** thres = 0.38761119072000033
AE Test time for  uSc1C1_z-score_20_14  = :  1.164566993713379
[[74242     0]
 [  359 15239]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.023015771252724707, tnr: 0.9769842287472753, acc: 0.9960040071237756
*** thres = 0.46281092528854906
AE Test time for  uSc1C1_z-score_20_14  = :  1.6629440784454346
[[74242     0]
 [  345 15253]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.02211822028465188, tnr: 0.9778817797153482, acc: 0.996159839715049
*** thres = 0.5380106598570978
AE Test time for  uSc1C1_z-score_20_14  = :  1.323944091796875
[[74030   212]
 [  338 15260]]
tpr (recall): 0.997144473478624, fnr: 0.0028555265213760406, fpr: 0.021669444800615462, tnr: 0.9783305551993845, acc: 0.9938780053428317
*** thres = 0.6132103944256466
AE Test time for  uSc1C1_z-score_20_14  = :  1.262558937072754
[[73048  1194]
 [  334 15264]]
tpr (recall): 0.9839174591201746, fnr: 0.016082540879825434, fpr: 0.021413001666880368, tnr: 0.9785869983331197, acc: 0.9829919857524488
*** thres = 0.6884101289941954
AE Test time for  uSc1C1_z-score_20_14  = :  1.9377672672271729
[[73002  1240]
 [  308 15290]]
tpr (recall): 0.9832978637428949, fnr: 0.016702136257105142, fpr: 0.019746121297602257, tnr: 0.9802538787023978, acc: 0.9827693677649154
*** thres = 0.7636098635627442
AE Test time for  uSc1C1_z-score_20_14  = :  1.5430667400360107
[[73000  1242]
 [  129 15469]]
tpr (recall): 0.9832709248134479, fnr: 0.016729075186552086, fpr: 0.00827029106295679, tnr: 0.9917297089370433, acc: 0.9847395369545859
*** thres = 0.838809598131293
AE Test time for  uSc1C1_z-score_20_14  = :  1.4387378692626953
[[72998  1244]
 [   86 15512]]
tpr (recall): 0.983243985884001, fnr: 0.01675601411599903, fpr: 0.005513527375304526, tnr: 0.9944864726246955, acc: 0.9851959038290294
*** thres = 0.9140093326998416
AE Test time for  uSc1C1_z-score_20_14  = :  1.0826280117034912
[[72998  1244]
 [   77 15521]]
tpr (recall): 0.983243985884001, fnr: 0.01675601411599903, fpr: 0.004936530324400564, tnr: 0.9950634696755994, acc: 0.9852960819234194
*** thres = 0.9892090672683904
AE Test time for  uSc1C1_z-score_20_14  = :  1.0465059280395508
[[72998  1244]
 [   59 15539]]
tpr (recall): 0.983243985884001, fnr: 0.01675601411599903, fpr: 0.00378253622259264, tnr: 0.9962174637774074, acc: 0.9854964381121994
*** thres = 1.064408801836939
AE Test time for  uSc1C1_z-score_20_14  = :  1.0736808776855469
[[72998  1244]
 [   48 15550]]
tpr (recall): 0.983243985884001, fnr: 0.01675601411599903, fpr: 0.003077317604821131, tnr: 0.9969226823951789, acc: 0.9856188780053429
*** thres = 1.139608536405488
AE Test time for  uSc1C1_z-score_20_14  = :  1.1358518600463867
[[72997  1245]
 [   35 15563]]
tpr (recall): 0.9832305164192775, fnr: 0.016769483580722503, fpr: 0.0022438774201820745, tnr: 0.9977561225798179, acc: 0.9857524487978628
*** thres = 1.2148082709740367
AE Test time for  uSc1C1_z-score_20_14  = :  1.2362051010131836
[[72991  1251]
 [   34 15564]]
tpr (recall): 0.9831496996309367, fnr: 0.016850300369063334, fpr: 0.002179766636748301, tnr: 0.9978202333632517, acc: 0.9856967943009796
*** thres = 1.2900080055425853
AE Test time for  uSc1C1_z-score_20_14  = :  1.4449658393859863
[[72977  1265]
 [   33 15565]]
tpr (recall): 0.9829611271248081, fnr: 0.01703887287519194, fpr: 0.0021156558533145277, tnr: 0.9978843441466855, acc: 0.9855520926090828
*** thres = 1.3652077401111342
AE Test time for  uSc1C1_z-score_20_14  = :  1.4571378231048584
[[72954  1288]
 [   33 15565]]
tpr (recall): 0.9826513294361682, fnr: 0.017348670563831794, fpr: 0.0021156558533145277, tnr: 0.9978843441466855, acc: 0.9852960819234194
*** thres = 1.4404074746796829
AE Test time for  uSc1C1_z-score_20_14  = :  1.5622320175170898
[[72932  1310]
 [   33 15565]]
tpr (recall): 0.9823550012122518, fnr: 0.017644998787748174, fpr: 0.0021156558533145277, tnr: 0.9978843441466855, acc: 0.9850512021371327
AE_thres: out_file:Figures/uSc1C1_z-score_20_14_thres_res_metrics_of_27_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
PCA Training time for case uSc1C1_z-score_20_14  =  0.24653887748718262
x_test.shape: (89840, 27)
PCA Testing Time :  0.09160423278808594
[[73003  1239]
 [ 1576 14022]]
tpr (recall): 0.9833113332076183, fnr: 0.016688666792381672, fpr: 0.10103859469162713, tnr: 0.8989614053083729, acc: 0.968666518254675

4). train and evaluate IF...
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)
IF Training time for case uSc1C1_z-score_20_14  =  3.8666269779205322
x_norm_train.shape: (54591, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.587702989578247
[[    0     0]
 [ 5457 49134]]
tpr (recall): 0, fnr: 0, fpr: 0.09996153212067924, tnr: 0.9000384678793207, acc: 0.9000384678793207
x_test.shape: (89840, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  2.76580810546875
[[73123  1119]
 [ 1554 14044]]
tpr (recall): 0.984927668974435, fnr: 0.015072331025565044, fpr: 0.09962815745608411, tnr: 0.9003718425439159, acc: 0.970247105966162
key:DT, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C1_z-score_20_14_roc_data_of_27_features_ROC.pdf

@@@train and evaluate AE on UNB: uSc1C2_z-score_20_14

Step 1. loading data...

+Step 1-1. preprocessing data...
len(mu) = 0, len(d_std) = 0
the variance of the 18-th feature is 0.
the variance of the 24-th feature is 0.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 27), x_attack_train:0
x_norm_val:(5984, 27), x_attack_val:0
x_norm_test:(11967, 27), x_attack_test:(35953, 27)

Step 3. train and evaluate AE on case: uSc1C2_z-score_20_14

Step 3-1. train AE on case: uSc1C2_z-score_20_14
x_norm_train.shape: (41881, 27)
AE training for Case :  uSc1C2_z-score_20_14  =  238.22742223739624 s
Train Loss =  0.12287134124742492 model.metrics_names ['loss']
Validation Loss =  0.12180332010761302 model.metrics_names ['loss']
training_losses:{'val_loss': [0.4682593799051754, 0.35287941211366397, 0.31795314432465455, 0.29932367498861917, 0.2795342077067829, 0.2684407490778734, 0.26092272443089254, 0.2448055109875725, 0.2439190431393404, 0.22913960634387112, 0.22717963031587754, 0.22227390198146596, 0.2233545111621765, 0.2200662321186958, 0.2086666572619887, 0.20763021819094285, 0.20942326157010174, 0.20138230696718962, 0.20059730248017746, 0.1981163373924194, 0.19118809751807686, 0.18730793777793486, 0.18835815177722412, 0.1919159044954866, 0.18574503872961923, 0.1757865769659134, 0.18939498433454788, 0.17426631400451303, 0.1772733257017671, 0.17622670810171628, 0.1729428492446634, 0.17553905576945625, 0.17189843876954705, 0.16565668136678277, 0.16076584598597357, 0.16710385648324527, 0.1611885161482714, 0.1580698499306638, 0.16210586095557494, 0.15675484891084426, 0.1512142775610169, 0.1582878712106516, 0.1548760856456935, 0.15253968628491948, 0.16089808948855985, 0.15307357580585276, 0.15303585801851302, 0.14619852957081667, 0.1494169247580722, 0.15857326211457584, 0.151478100149708, 0.14503727339327654, 0.14536867278782442, 0.1387900109278327, 0.1410329576960222, 0.13704523372458902, 0.1373166783767588, 0.14584582518128789, 0.13906855251699846, 0.13547057279928482, 0.13939550809841106, 0.13758681630865138, 0.13701245858070046, 0.1397507141299426, 0.12851016928646017, 0.1336590941736405, 0.13225137545941348, 0.12882592873697613, 0.13136821654550532, 0.12724104151129723, 0.12906233328867722, 0.13154679835639535, 0.15453170291720864, 0.1332490095559926, 0.12395744342456527, 0.12410372965794833, 0.1263597776943987, 0.13861471717370386, 0.12195914987733657, 0.12651251109048006, 0.1256214927702664, 0.12386844103986566, 0.12564920036391142, 0.1221041202664694, 0.12522160210073952, 0.11761234511427063, 0.12003075857372845, 0.12370809438553723, 0.11989300861396891, 0.12473507058174214, 0.11649823328231108, 0.11671955767959197, 0.11747787735439877, 0.11636227540631983, 0.12127036091318742, 0.1197381357458186, 0.11640212752602318, 0.11688033575042683, 0.1250212626023726, 0.12180332010761302], 'loss': [1.047197425666595, 0.4240112760606603, 0.3594109494340405, 0.3264560724283334, 0.3069124090747253, 0.2929555476088968, 0.280920480077034, 0.27200291775486674, 0.2630961049210333, 0.25557360342539404, 0.24839242477587178, 0.24268939946536955, 0.23844622240541077, 0.23334744328277643, 0.22914942428734728, 0.22529843347158449, 0.2211755681181218, 0.21648329777179168, 0.21377102280446694, 0.21036107463605658, 0.20699457379803354, 0.2049082292998174, 0.20122208676838932, 0.199105191952972, 0.1963393282492965, 0.1939852073753419, 0.19151699315253196, 0.18979489584747716, 0.18798665654345884, 0.1846306851567644, 0.18233434655730624, 0.17985967364444086, 0.1764082509388054, 0.17419781146176505, 0.17180512049561292, 0.17121637100463913, 0.16867519195396435, 0.16664024843649525, 0.16522780325303676, 0.16343333868724405, 0.16325695101480475, 0.1610667649730807, 0.1611859971996604, 0.15994015872366052, 0.15731349643834416, 0.1579118776106794, 0.154996666972507, 0.15452019656802632, 0.153382626025805, 0.15349935880078733, 0.1521176129078937, 0.14941966985879696, 0.1496598253502084, 0.14780628742771434, 0.14683872170418816, 0.14582714748053527, 0.1451676092524745, 0.14367880035783376, 0.1429861232599933, 0.14227668957850195, 0.14104190562380717, 0.14061497008038246, 0.13881826959928414, 0.13926893884649602, 0.13787228291098771, 0.13783441604785548, 0.13612140441638362, 0.13496556155482675, 0.13534487061461725, 0.133973293099817, 0.13456357728266244, 0.13305622920319582, 0.13272917176445184, 0.13261212000122516, 0.13092374069866725, 0.1306934127006062, 0.12970505791117937, 0.12965166651906013, 0.12943803989197133, 0.12863875829991467, 0.12859369728328454, 0.1287888668395524, 0.12742032915861143, 0.12757653610867606, 0.12762177368953198, 0.1266585136376933, 0.12678038313213147, 0.12574342055208565, 0.12512257744351504, 0.12520640551088955, 0.12464955698482878, 0.1243507281101973, 0.12383316748634268, 0.12364867867278875, 0.12262011266794198, 0.12302820619293277, 0.12244967082299879, 0.12115113031281796, 0.12164552625988209, 0.12244382004559841]}
optimal_thres_AE_val:1.8447308963344942, factor = 15, key = loss
Test AE on train set on case: uSc1C2_z-score_20_14
x_norm_train.shape: (41881, 27)
AE Test time for  uSc1C2_z-score_20_14  = :  0.5992493629455566
[[    0     0]
 [  238 41643]]
tpr (recall): 0, fnr: 0, fpr: 0.005682767842219622, tnr: 0.9943172321577803, acc: 0.9943172321577803

Step 3-2. evaluate AE on case: uSc1C2_z-score_20_14

1). evaluate AE on test set:
x_test.shape: (47920, 27), case: uSc1C2_z-score_20_14
optimal_thres_AE 1.8447308963344942 achieved from key=loss, factor = 15, key = loss
AE Test time for  uSc1C2_z-score_20_14  = :  0.7128801345825195
[[32024  3929]
 [   82 11885]]
tpr (recall): 0.8907184379606709, fnr: 0.10928156203932912, fpr: 0.006852176819587198, tnr: 0.9931478231804128, acc: 0.9162979966611018

save the FPR and FNR reausts of AE with num =27 features on test set.
output_pre_path:uSc1C2_z-score_20_14_recon_err_of_27_features
*the maximize reconstrcution error is 12.595432309229603 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_20_14_recon_err_of_27_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 12.595432309229603 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 80.22975312623556 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_20_14_recon_err_of_27_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 80.22975312623556 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 27 features.
*** thres = 0.017179391845750864
AE Test time for  uSc1C2_z-score_20_14  = :  0.7330350875854492
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** thres = 0.21045741294171072
AE Test time for  uSc1C2_z-score_20_14  = :  0.738771915435791
[[35953     0]
 [ 1349 10618]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.11272666499540403, tnr: 0.8872733350045959, acc: 0.9718489148580969
*** thres = 0.40373543403767054
AE Test time for  uSc1C2_z-score_20_14  = :  0.7801122665405273
[[34699  1254]
 [  689 11278]]
tpr (recall): 0.9651211303646428, fnr: 0.034878869635357274, fpr: 0.0575749979109217, tnr: 0.9424250020890783, acc: 0.9594532554257095
*** thres = 0.5970134551336305
AE Test time for  uSc1C2_z-score_20_14  = :  0.7434768676757812
[[33727  2226]
 [  340 11627]]
tpr (recall): 0.9380858342836481, fnr: 0.0619141657163519, fpr: 0.028411464861703015, tnr: 0.971588535138297, acc: 0.9464524207011686
*** thres = 0.7902914762295903
AE Test time for  uSc1C2_z-score_20_14  = :  0.7413899898529053
[[33604  2349]
 [  235 11732]]
tpr (recall): 0.9346647011375963, fnr: 0.06533529886240369, fpr: 0.019637336007353557, tnr: 0.9803626639926465, acc: 0.946076794657763
*** thres = 0.9835694973255501
AE Test time for  uSc1C2_z-score_20_14  = :  0.75412917137146
[[33219  2734]
 [  145 11822]]
tpr (recall): 0.923956276249548, fnr: 0.07604372375045199, fpr: 0.012116654132196874, tnr: 0.9878833458678031, acc: 0.9399207011686144
*** thres = 1.17684751842151
AE Test time for  uSc1C2_z-score_20_14  = :  0.7951450347900391
[[32444  3509]
 [  110 11857]]
tpr (recall): 0.90240035602036, fnr: 0.09759964397964009, fpr: 0.009191944514080388, tnr: 0.9908080554859197, acc: 0.9244782971619365
*** thres = 1.3701255395174696
AE Test time for  uSc1C2_z-score_20_14  = :  0.8759617805480957
[[32104  3849]
 [   97 11870]]
tpr (recall): 0.8929435652101354, fnr: 0.10705643478986454, fpr: 0.008105623798779979, tnr: 0.99189437620122, acc: 0.9176544240400668
*** thres = 1.5634035606134296
AE Test time for  uSc1C2_z-score_20_14  = :  0.7824356555938721
[[32039  3914]
 [   91 11876]]
tpr (recall): 0.8911356493199455, fnr: 0.10886435068005451, fpr: 0.007604245007102866, tnr: 0.9923957549928971, acc: 0.9164232053422371
*** thres = 1.7566815817093895
AE Test time for  uSc1C2_z-score_20_14  = :  0.7769861221313477
[[32024  3929]
 [   84 11883]]
tpr (recall): 0.8907184379606709, fnr: 0.10928156203932912, fpr: 0.007019303083479569, tnr: 0.9929806969165205, acc: 0.9162562604340567
*** thres = 1.9499596028053492
AE Test time for  uSc1C2_z-score_20_14  = :  0.7798399925231934
[[32023  3930]
 [   74 11893]]
tpr (recall): 0.8906906238700526, fnr: 0.10930937612994743, fpr: 0.006183671764017715, tnr: 0.9938163282359823, acc: 0.9164440734557596
*** thres = 2.1432376239013093
AE Test time for  uSc1C2_z-score_20_14  = :  1.1111290454864502
[[32022  3931]
 [   61 11906]]
tpr (recall): 0.8906628097794342, fnr: 0.10933719022056573, fpr: 0.005097351048717306, tnr: 0.9949026489512827, acc: 0.91669449081803
*** thres = 2.3365156449972693
AE Test time for  uSc1C2_z-score_20_14  = :  1.0525853633880615
[[32010  3943]
 [   58 11909]]
tpr (recall): 0.8903290406920146, fnr: 0.10967095930798543, fpr: 0.00484666165287875, tnr: 0.9951533383471213, acc: 0.9165066777963272
*** thres = 2.529793666093229
AE Test time for  uSc1C2_z-score_20_14  = :  0.8362460136413574
[[32010  3943]
 [   53 11914]]
tpr (recall): 0.8903290406920146, fnr: 0.10967095930798543, fpr: 0.004428845993147823, tnr: 0.9955711540068521, acc: 0.9166110183639399
*** thres = 2.7230716871891887
AE Test time for  uSc1C2_z-score_20_14  = :  1.1329100131988525
[[31999  3954]
 [   45 11922]]
tpr (recall): 0.8900230856952132, fnr: 0.1099769143047868, fpr: 0.0037603409375783405, tnr: 0.9962396590624216, acc: 0.9165484140233723
*** thres = 2.9163497082851486
AE Test time for  uSc1C2_z-score_20_14  = :  1.1400790214538574
[[31905  4048]
 [    6 11961]]
tpr (recall): 0.8874085611770923, fnr: 0.11259143882290769, fpr: 0.000501378791677112, tnr: 0.9994986212083229, acc: 0.9154006677796327
*** thres = 3.1096277293811085
AE Test time for  uSc1C2_z-score_20_14  = :  0.8732919692993164
[[31306  4647]
 [    4 11963]]
tpr (recall): 0.8707479208967263, fnr: 0.12925207910327371, fpr: 0.00033425252778474136, tnr: 0.9996657474722153, acc: 0.9029424040066778
*** thres = 3.3029057504770685
AE Test time for  uSc1C2_z-score_20_14  = :  1.707705020904541
[[30915  5038]
 [    4 11963]]
tpr (recall): 0.8598726114649682, fnr: 0.14012738853503184, fpr: 0.00033425252778474136, tnr: 0.9996657474722153, acc: 0.8947829716193656
*** thres = 3.4961837715730284
AE Test time for  uSc1C2_z-score_20_14  = :  1.5002999305725098
[[30789  5164]
 [    3 11964]]
tpr (recall): 0.8563680360470615, fnr: 0.14363196395293856, fpr: 0.000250689395838556, tnr: 0.9997493106041614, acc: 0.8921744574290484
*** thres = 3.6894617926689883
AE Test time for  uSc1C2_z-score_20_14  = :  1.8932950496673584
[[30573  5380]
 [    3 11964]]
tpr (recall): 0.850360192473507, fnr: 0.14963980752649292, fpr: 0.000250689395838556, tnr: 0.9997493106041614, acc: 0.8876669449081803
AE_thres: out_file:Figures/uSc1C2_z-score_20_14_thres_res_metrics_of_27_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
PCA Training time for case uSc1C2_z-score_20_14  =  0.2569279670715332
x_test.shape: (47920, 27)
PCA Testing Time :  0.05827903747558594
[[35953     0]
 [ 1150 10817]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.09609760173811314, tnr: 0.9039023982618869, acc: 0.9760016694490818
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.

  FutureWarning)
4). train and evaluate IF...
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)
IF Training time for case uSc1C2_z-score_20_14  =  3.4333231449127197
x_norm_train.shape: (41881, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.5756721496582031
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.4140269756317139
[[18630 17323]
 [ 1158 10809]]
tpr (recall): 0.5181765082190638, fnr: 0.4818234917809362, fpr: 0.09676610679368262, tnr: 0.9032338932063174, acc: 0.6143363939899833
key:DT, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_20_14_roc_data_of_27_features_ROC.pdf

@@@train and evaluate AE on MAWI: uSc1C3_z-score_20_14

Step 1. loading data...

+Step 1-1. preprocessing data...
len(mu) = 0, len(d_std) = 0
the variance of the 24-th feature is 0.
all_norm:62000, all_attack:0
x_norm_train:(43400, 27), x_attack_train:0
x_norm_val:(6200, 27), x_attack_val:0
x_norm_test:(12400, 27), x_attack_test:0

Step 3. train and evaluate AE on case: uSc1C3_z-score_20_14

Step 3-1. train AE on case: uSc1C3_z-score_20_14
x_norm_train.shape: (43400, 27)
AE training for Case :  uSc1C3_z-score_20_14  =  237.4641819000244 s
Train Loss =  0.07141824160869907 model.metrics_names ['loss']
Validation Loss =  0.07050034008199169 model.metrics_names ['loss']
training_losses:{'val_loss': [0.34220186708434935, 0.2531992437378053, 0.20908446395589458, 0.19084925026662888, 0.1792330546052225, 0.1819423730142655, 0.16474356758979058, 0.15634737009002317, 0.15580827375573497, 0.1446755493552454, 0.13485042870044708, 0.13573932066079109, 0.12881289481155334, 0.1281539987556396, 0.12681929969979872, 0.12447954702761865, 0.12093251892635899, 0.11828928370148904, 0.11821780110559156, 0.11769277862002772, 0.11434928342219322, 0.1110813309781013, 0.10740063217378432, 0.10902464137923333, 0.12177272063109182, 0.11189010684528658, 0.10475828298637944, 0.10979289194268566, 0.10426983060375336, 0.10781920006198267, 0.10159493085838134, 0.10207413331154853, 0.11131952388632682, 0.11044757847824405, 0.10237879701679753, 0.10173799595525188, 0.10665228970589176, 0.0942979668321148, 0.09945869302557361, 0.0951030602955049, 0.09359533036908796, 0.09020369282653255, 0.09138465469883335, 0.093851680015364, 0.09238716087995037, 0.0909754438554087, 0.08813239623462, 0.08814114018313346, 0.09345533152741771, 0.09425493841690402, 0.09194969077264109, 0.08796664214903309, 0.08428309228151075, 0.08698603666597797, 0.08621132241141412, 0.08609409943703682, 0.08379935892839585, 0.08148869917277367, 0.08824359802469131, 0.09469688269880511, 0.08051237263987142, 0.07989978161550337, 0.08345541909337044, 0.10143732459314408, 0.0877871347050513, 0.08247497873921548, 0.0790782561081071, 0.08560069924400698, 0.08141383546975352, 0.08037896459621768, 0.08103208451021102, 0.08056570753935845, 0.08048297945530183, 0.07886537166853105, 0.08170080931917313, 0.08234012531657373, 0.08175434315396893, 0.07306118808206051, 0.07317694052092491, 0.07791670827134962, 0.07449079005468276, 0.07652356737083005, 0.07282403458991359, 0.07080806437038606, 0.08292892169567846, 0.07664986772883323, 0.07860153136714812, 0.09132723951531994, 0.08231513429072596, 0.07332570893149222, 0.0713288230569132, 0.07451266785783152, 0.07880240969600216, 0.06728251519222413, 0.07335076615214348, 0.07504094160372211, 0.08584547721570537, 0.07684497347281825, 0.07954040921022815, 0.07050034008199169], 'loss': [0.7516993381907039, 0.31590184738078425, 0.2542167991083888, 0.2254604604751009, 0.20754156532512832, 0.19516295448494947, 0.1818488590899975, 0.1716248856931238, 0.16311583694568427, 0.15503358764513847, 0.15047249946588745, 0.14627776603407575, 0.1418840335275171, 0.13814822471979576, 0.13646222294681631, 0.13367900260891508, 0.13124482004255195, 0.12895239719648927, 0.12830113889400585, 0.12524924904863405, 0.1260731963099148, 0.12169854535459441, 0.11942820755979433, 0.11870177269393947, 0.11690381641761499, 0.11510548682668792, 0.11274254781721924, 0.11335687838048429, 0.10997105815443575, 0.10795416449552857, 0.10797287431592766, 0.10910275023928435, 0.10439623173206083, 0.10560921363395205, 0.10415171634354349, 0.10332972512576162, 0.1021377953329909, 0.10305751015101709, 0.10117031783552213, 0.10135523782158914, 0.09923618364031964, 0.09859214946558947, 0.09894438517464471, 0.09626513695181241, 0.09765794867126074, 0.09570592160152125, 0.09550911740155264, 0.09452381451009056, 0.0932085090779489, 0.09433276543282144, 0.09301388986031031, 0.09273644205131289, 0.09160273321556606, 0.0900112568350157, 0.09198378028133498, 0.0894301825178109, 0.08928745698132273, 0.08673453585618103, 0.08898727991648259, 0.08684357723744783, 0.08671545217388786, 0.08589922340578197, 0.08611054935625621, 0.08505836584806992, 0.08568178542799526, 0.08327969845882209, 0.08447601092987896, 0.0829451709786593, 0.08246402740615853, 0.0841677741136419, 0.08241988897769957, 0.08199383226064492, 0.08110601079045078, 0.08091274963614578, 0.08137484460880268, 0.08095048238742186, 0.07968520489637204, 0.07796039178280786, 0.0789941113085104, 0.07724387581309965, 0.07879294352889199, 0.07848442339883421, 0.07758715043522521, 0.07574258769437464, 0.07822032675473234, 0.07531487448492907, 0.07722504669414137, 0.0763823402442965, 0.07598519376346043, 0.07611032851160535, 0.07633616132738953, 0.07398447380465571, 0.07506062983470853, 0.0737957484807287, 0.07296027052031684, 0.07320128379604234, 0.07322020037382979, 0.07316354385581433, 0.07316497400952374, 0.07288034152565738]}
optimal_thres_AE_val:1.1066514412930002, factor = 15, key = loss
Test AE on train set on case: uSc1C3_z-score_20_14
x_norm_train.shape: (43400, 27)
AE Test time for  uSc1C3_z-score_20_14  = :  0.9851961135864258
[[    0     0]
 [  382 43018]]
tpr (recall): 0, fnr: 0, fpr: 0.00880184331797235, tnr: 0.9911981566820276, acc: 0.9911981566820276

Step 3-2. evaluate AE on case: uSc1C3_z-score_20_14

1). evaluate AE on test set:
x_test.shape: (12400, 27), case: uSc1C3_z-score_20_14
optimal_thres_AE 1.1066514412930002 achieved from key=loss, factor = 15, key = loss
AE Test time for  uSc1C3_z-score_20_14  = :  0.4784681797027588
[[    0     0]
 [  102 12298]]
tpr (recall): 0, fnr: 0, fpr: 0.008225806451612904, tnr: 0.9917741935483871, acc: 0.9917741935483871

save the FPR and FNR reausts of AE with num =27 features on test set.

-Evaluate AE with different thresholds on test set with num = 27 features.
*** thres = 0.003449502691827351
AE Test time for  uSc1C3_z-score_20_14  = :  0.39005398750305176
[[    0     0]
 [12400     0]]
tpr (recall): 0, fnr: 0, fpr: 1.0, tnr: 0.0, acc: 0.0
*** thres = 0.11975757531783646
AE Test time for  uSc1C3_z-score_20_14  = :  0.39530396461486816
[[    0     0]
 [ 1060 11340]]
tpr (recall): 0, fnr: 0, fpr: 0.08548387096774193, tnr: 0.9145161290322581, acc: 0.9145161290322581
*** thres = 0.23606564794384555
AE Test time for  uSc1C3_z-score_20_14  = :  0.41298604011535645
[[    0     0]
 [  679 11721]]
tpr (recall): 0, fnr: 0, fpr: 0.05475806451612903, tnr: 0.9452419354838709, acc: 0.9452419354838709
*** thres = 0.35237372056985466
AE Test time for  uSc1C3_z-score_20_14  = :  0.42681074142456055
[[    0     0]
 [  435 11965]]
tpr (recall): 0, fnr: 0, fpr: 0.03508064516129032, tnr: 0.9649193548387097, acc: 0.9649193548387097
*** thres = 0.4686817931958638
AE Test time for  uSc1C3_z-score_20_14  = :  0.414762020111084
[[    0     0]
 [  343 12057]]
tpr (recall): 0, fnr: 0, fpr: 0.027661290322580644, tnr: 0.9723387096774193, acc: 0.9723387096774193
*** thres = 0.5849898658218728
AE Test time for  uSc1C3_z-score_20_14  = :  0.49150991439819336
[[    0     0]
 [  279 12121]]
tpr (recall): 0, fnr: 0, fpr: 0.0225, tnr: 0.9775, acc: 0.9775
*** thres = 0.7012979384478819
AE Test time for  uSc1C3_z-score_20_14  = :  0.474776029586792
[[    0     0]
 [  213 12187]]
tpr (recall): 0, fnr: 0, fpr: 0.01717741935483871, tnr: 0.9828225806451613, acc: 0.9828225806451613
*** thres = 0.8176060110738911
AE Test time for  uSc1C3_z-score_20_14  = :  0.6263351440429688
[[    0     0]
 [  151 12249]]
tpr (recall): 0, fnr: 0, fpr: 0.012177419354838709, tnr: 0.9878225806451613, acc: 0.9878225806451613
*** thres = 0.9339140836999001
AE Test time for  uSc1C3_z-score_20_14  = :  0.5131340026855469
[[    0     0]
 [  128 12272]]
tpr (recall): 0, fnr: 0, fpr: 0.01032258064516129, tnr: 0.9896774193548387, acc: 0.9896774193548387
*** thres = 1.0502221563259093
AE Test time for  uSc1C3_z-score_20_14  = :  0.5296452045440674
[[    0     0]
 [  107 12293]]
tpr (recall): 0, fnr: 0, fpr: 0.008629032258064516, tnr: 0.9913709677419354, acc: 0.9913709677419354
*** thres = 1.1665302289519184
AE Test time for  uSc1C3_z-score_20_14  = :  0.4987368583679199
[[    0     0]
 [   95 12305]]
tpr (recall): 0, fnr: 0, fpr: 0.007661290322580645, tnr: 0.9923387096774193, acc: 0.9923387096774193
*** thres = 1.2828383015779274
AE Test time for  uSc1C3_z-score_20_14  = :  0.8060579299926758
[[    0     0]
 [   89 12311]]
tpr (recall): 0, fnr: 0, fpr: 0.00717741935483871, tnr: 0.9928225806451613, acc: 0.9928225806451613
*** thres = 1.3991463742039365
AE Test time for  uSc1C3_z-score_20_14  = :  0.7477247714996338
[[    0     0]
 [   80 12320]]
tpr (recall): 0, fnr: 0, fpr: 0.0064516129032258064, tnr: 0.9935483870967742, acc: 0.9935483870967742
*** thres = 1.5154544468299456
AE Test time for  uSc1C3_z-score_20_14  = :  0.6783158779144287
[[    0     0]
 [   79 12321]]
tpr (recall): 0, fnr: 0, fpr: 0.0063709677419354835, tnr: 0.9936290322580645, acc: 0.9936290322580645
*** thres = 1.6317625194559549
AE Test time for  uSc1C3_z-score_20_14  = :  0.4755740165710449
[[    0     0]
 [   79 12321]]
tpr (recall): 0, fnr: 0, fpr: 0.0063709677419354835, tnr: 0.9936290322580645, acc: 0.9936290322580645
*** thres = 1.748070592081964
AE Test time for  uSc1C3_z-score_20_14  = :  0.5113239288330078
[[    0     0]
 [   77 12323]]
tpr (recall): 0, fnr: 0, fpr: 0.006209677419354838, tnr: 0.9937903225806451, acc: 0.9937903225806451
*** thres = 1.864378664707973
AE Test time for  uSc1C3_z-score_20_14  = :  0.7541391849517822
[[    0     0]
 [   73 12327]]
tpr (recall): 0, fnr: 0, fpr: 0.005887096774193548, tnr: 0.9941129032258065, acc: 0.9941129032258065
*** thres = 1.980686737333982
AE Test time for  uSc1C3_z-score_20_14  = :  0.9503030776977539
[[    0     0]
 [   71 12329]]
tpr (recall): 0, fnr: 0, fpr: 0.005725806451612903, tnr: 0.9942741935483871, acc: 0.9942741935483871
*** thres = 2.0969948099599915
AE Test time for  uSc1C3_z-score_20_14  = :  0.6520519256591797
[[    0     0]
 [   70 12330]]
tpr (recall): 0, fnr: 0, fpr: 0.00564516129032258, tnr: 0.9943548387096774, acc: 0.9943548387096774
*** thres = 2.2133028825860004
AE Test time for  uSc1C3_z-score_20_14  = :  0.5642149448394775
[[    0     0]
 [   69 12331]]
tpr (recall): 0, fnr: 0, fpr: 0.005564516129032258, tnr: 0.9944354838709677, acc: 0.9944354838709677
AE_thres: out_file:Figures/uSc1C3_z-score_20_14_thres_res_metrics_of_27_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
PCA Training time for case uSc1C3_z-score_20_14  =  0.2359020709991455
x_test.shape: (12400, 27)
PCA Testing Time :  0.017609119415283203
[[    0     0]
 [ 1023 11377]]
tpr (recall): 0, fnr: 0, fpr: 0.0825, tnr: 0.9175, acc: 0.9175
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C3_z-score_20_14  =  3.2282660007476807
x_norm_train.shape: (43400, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.6673152446746826
[[    0     0]
 [ 4340 39060]]
tpr (recall): 0, fnr: 0, fpr: 0.1, tnr: 0.9, acc: 0.9
x_test.shape: (12400, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.31586503982543945
[[    0     0]
 [ 1182 11218]]
tpr (recall): 0, fnr: 0, fpr: 0.09532258064516129, tnr: 0.9046774193548387, acc: 0.9046774193548387
key:DT, value:[]
key:OCSVM, value:[]
/usr/local/lib/python3.6/site-packages/sklearn/metrics/ranking.py:648: UndefinedMetricWarning: No negative samples in y_true, false positive value should be meaningless
  UndefinedMetricWarning)
/usr/local/lib/python3.6/site-packages/sklearn/metrics/ranking.py:114: RuntimeWarning: invalid value encountered in less
  if np.any(dx < 0):
ROC:out_file:Figures/uSc1C3_z-score_20_14_roc_data_of_27_features_ROC.pdf

Process finished with exit code 0
