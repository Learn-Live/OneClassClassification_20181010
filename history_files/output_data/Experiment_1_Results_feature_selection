/usr/local/bin/python3.6 /Users/kunyang/PycharmProjects/anomaly_detection_20190611/autoencoder_main_20190612.py

Epochs:100, optimal_thres_AE:1.0, find_optimal_thres_flg:False

2019-06-17 10:32:29.464209: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
@@@train and evaluate AE on UNB: uSc1C2_z-score

Step 1. loading data...

+Step 1-1. preprocessing data...
len(mu) = 0, len(d_std) = 0
the variance of the 18-th feature is 0.
the variance of the 24-th feature is 0.

Step 2. analyize different number of features on case:uSc1C2_z-score.
thres=  0.01  , num=  4 : Int64Index([0, 1, 18, 24], dtype='int64')
thres=  0.060000000000000005  , num=  4 : Int64Index([0, 1, 18, 24], dtype='int64')
thres=  0.11000000000000001  , num=  4 : Int64Index([0, 1, 18, 24], dtype='int64')
thres=  0.16000000000000003  , num=  4 : Int64Index([0, 1, 18, 24], dtype='int64')
thres=  0.21000000000000002  , num=  6 : Int64Index([0, 1, 2, 10, 18, 24], dtype='int64')
0.21000000000000002 [0, 1, 2, 10, 18, 24]
thres=  0.26  , num=  7 : Int64Index([0, 1, 2, 10, 14, 18, 24], dtype='int64')
0.26 [0, 1, 2, 10, 14, 18, 24]
thres=  0.31  , num=  8 : Int64Index([0, 1, 2, 10, 14, 18, 21, 24], dtype='int64')
0.31 [0, 1, 2, 10, 14, 18, 21, 24]
thres=  0.36  , num=  10 : Int64Index([0, 1, 2, 6, 10, 14, 16, 18, 21, 24], dtype='int64')
0.36 [0, 1, 2, 6, 10, 14, 16, 18, 21, 24]
thres=  0.41  , num=  10 : Int64Index([0, 1, 2, 6, 10, 14, 16, 18, 21, 24], dtype='int64')
thres=  0.45999999999999996  , num=  10 : Int64Index([0, 1, 2, 6, 10, 14, 16, 18, 21, 24], dtype='int64')
thres=  0.51  , num=  10 : Int64Index([0, 1, 2, 6, 10, 14, 16, 18, 21, 24], dtype='int64')
thres=  0.56  , num=  10 : Int64Index([0, 1, 2, 6, 10, 14, 16, 18, 21, 24], dtype='int64')
thres=  0.6100000000000001  , num=  10 : Int64Index([0, 1, 2, 6, 10, 14, 16, 18, 21, 24], dtype='int64')
thres=  0.6600000000000001  , num=  11 : Int64Index([0, 1, 2, 6, 10, 11, 14, 16, 18, 21, 24], dtype='int64')
0.6600000000000001 [0, 1, 2, 6, 10, 11, 14, 16, 18, 21, 24]
thres=  0.7100000000000002  , num=  13 : Int64Index([0, 1, 2, 6, 7, 8, 10, 11, 14, 16, 18, 21, 24], dtype='int64')
0.7100000000000002 [0, 1, 2, 6, 7, 8, 10, 11, 14, 16, 18, 21, 24]
thres=  0.7600000000000002  , num=  15 : Int64Index([0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 21, 24], dtype='int64')
0.7600000000000002 [0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 21, 24]
thres=  0.8100000000000003  , num=  16 : Int64Index([0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 21, 23, 24], dtype='int64')
0.8100000000000003 [0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 21, 23, 24]
thres=  0.8600000000000003  , num=  17 : Int64Index([0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 20, 21, 23, 24], dtype='int64')
0.8600000000000003 [0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 20, 21, 23, 24]
thres=  0.9100000000000004  , num=  18 : Int64Index([0, 1, 2, 3, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 20, 21, 23, 24], dtype='int64')
0.9100000000000004 [0, 1, 2, 3, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 20, 21, 23, 24]
thres=  0.9600000000000004  , num=  21 : Int64Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 21, 22,
            23, 24],
           dtype='int64')
0.9600000000000004 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 21, 22, 23, 24]
1.0100000000000005 all features: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26]

---num_sub_features:4, they are [0, 1, 18, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 4), x_attack_train:0
x_norm_val:(5984, 4), x_attack_val:0
x_norm_test:(11967, 4), x_attack_test:(35953, 4)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 4)
AE training for Case :  uSc1C2_z-score  =  140.64340496063232 s
Train Loss =  0.0014025045061015972 model.metrics_names ['loss']
Validation Loss =  0.0013384202104261055 model.metrics_names ['loss']
training_losses:{'val_loss': [0.002532236598043598, 0.003834931768805665, 0.003397785902850051, 0.002934465906333756, 0.001877673323276169, 0.005316122176055921, 0.0023476927320816537, 0.0038930117638213907, 0.0022333534926245796, 0.00311007159189346, 0.005415775023779289, 0.0024223920744769075, 0.0030169553922758225, 0.00511870237769569, 0.0018429200648688736, 0.0031860085069774623, 0.003615697275568298, 0.00815443533104172, 0.0029562111435966058, 0.004472371469685101, 0.002747671795700164, 0.003950649912264895, 0.0032915829763035566, 0.006533539530268327, 0.002641393483696097, 0.002477939245614776, 0.0043526258653298735, 0.0026266290143226838, 0.0055866889813715685, 0.0047448409153497155, 0.0031415956645188007, 0.0021593618551567994, 0.001972121128658042, 0.005722905936237564, 0.002849812904512261, 0.004154140284075776, 0.002276941187639925, 0.00265213350496469, 0.005467049189828296, 0.0038821607078599898, 0.0015798763099330712, 0.003493911926609708, 0.001642194720991155, 0.0026550409782498596, 0.005408805727779387, 0.002961080957124418, 0.0038607863368177635, 0.005397439906921457, 0.0019102546854572182, 0.0035880409423286784, 0.001994810241428926, 0.003620692294708548, 0.004528029778235179, 0.0011907999439882164, 0.004069968701942879, 0.00449245891728025, 0.0019284803021878483, 0.002534645207395608, 0.0014473686584913954, 0.005132353587579082, 0.0032020754792184674, 0.0026350042180103414, 0.0025154554601360293, 0.0014418229942563623, 0.002444513942697708, 0.0026246085439255848, 0.002693603557340283, 0.006843291595329177, 0.00335794641576548, 0.002650344147929613, 0.0024046019014757982, 0.001813547610414817, 0.0017720625149384938, 0.0023417121999682908, 0.0031166969484744227, 0.0010109298199821105, 0.0038109335308784947, 0.0024680884425493485, 0.0014409531103347472, 0.0036391988720366345, 0.0020853834062376443, 0.0027797873216596517, 0.002341409985170286, 0.0029282109845519305, 0.0015030333480952097, 0.002090250004336915, 0.0015770078301778371, 0.0019345711256790767, 0.002264239387038876, 0.001673222299700075, 0.0019756936266480444, 0.002625813441883952, 0.0019180006901658873, 0.002373793708997216, 0.0016294129057115015, 0.002194389563930385, 0.0019214072452738563, 0.0018392541924526387, 0.0011402275254526598, 0.0013384202104261055], 'loss': [0.04563252560727241, 0.004254746250363492, 0.004269160078499237, 0.004102774232454111, 0.0043231137371846735, 0.004091183298221237, 0.004164151653163716, 0.003968257071889185, 0.003983149485525509, 0.00385126033562033, 0.0037643447438205275, 0.003567726129125114, 0.00377910261191562, 0.003631014352645583, 0.003509979024528234, 0.003954015725415305, 0.003659242601615878, 0.00373845058411038, 0.0040750379377557065, 0.0035361193342892026, 0.003664733712627229, 0.003735695205765543, 0.003535757045240681, 0.0037078454966705185, 0.003490526129820006, 0.003470053762455759, 0.00345064249961892, 0.003639896424122407, 0.0035079826732950623, 0.0036334537793122007, 0.0034530437830517587, 0.003361476174044727, 0.0034355586610925882, 0.00366217562850209, 0.0033828011180648066, 0.0035310550347561714, 0.0033610569694033227, 0.0030747072907217486, 0.0035936705456140546, 0.003484404286507353, 0.003580627895984663, 0.0033830744104197657, 0.0032248025399275776, 0.0030936100461653746, 0.003418575194478284, 0.00318010500106869, 0.002838488786656173, 0.003094812272188947, 0.0033412529977893705, 0.003157332648507541, 0.003035340606811382, 0.003035915898526196, 0.0032239071835971516, 0.0028128050210262856, 0.003143279912208495, 0.0030548858110311518, 0.0029107261865098308, 0.0028436761090485647, 0.0030102719427863274, 0.0027772970274567536, 0.00296368357078757, 0.002869663375437659, 0.003035544300757772, 0.0028852036205236887, 0.0028265980385115672, 0.003217046240036923, 0.0026411438814985975, 0.0027545445456465148, 0.0028061423031334153, 0.003038618611903673, 0.002755667686464893, 0.002797741119715532, 0.0030395079279575384, 0.002633951085724522, 0.0027218906332862713, 0.0028116914507656907, 0.0026232181575639585, 0.002614813518881173, 0.0026909026450122123, 0.0027072514445951874, 0.0028500986995635305, 0.0028007497915105537, 0.0026272965965806147, 0.0026058999601188204, 0.0025585228437800204, 0.002604392888779519, 0.002578455502779783, 0.002648908714959509, 0.0025704530817023917, 0.0026667080961703467, 0.0025804869374453547, 0.002400639204785204, 0.002606926845082173, 0.0024040975454443845, 0.002736936503817504, 0.002698429493854573, 0.0026475979621621505, 0.0023954117859133492, 0.0023533818231462294, 0.002355051646393794]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 4)
AE Test time for  uSc1C2_z-score  = :  0.44609522819519043
[[41881]]
tpr (recall): -1, fnr: -1, fpr: -1, tnr: -1, acc: -1

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 4), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.5054061412811279
[[31904  4049]
 [    0 11967]]
tpr (recall): 0.887380747086474, fnr: 0.112619252913526, fpr: 0.0, tnr: 1.0, acc: 0.9155050083472455

save the FPR and FNR reausts of AE with num =4 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_4_features
*the maximize reconstrcution error is 0.03840915048050486 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_4_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 0.03840915048050486 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 62.936931378144 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_4_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 62.936931378144 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 4 features.
*** idx: 0,  thres = 0.0009790131684495654
AE Test time for  uSc1C2_z-score  = :  0.5384080410003662
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0004895065842248
AE Test time for  uSc1C2_z-score  = :  0.5180208683013916
[[31904  4049]
 [    0 11967]]
tpr (recall): 0.887380747086474, fnr: 0.112619252913526, fpr: 0.0, tnr: 1.0, acc: 0.9155050083472455
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  0.5525429248809814
[[30363  5590]
 [    0 11967]]
tpr (recall): 0.8445192334436625, fnr: 0.15548076655633744, fpr: 0.0, tnr: 1.0, acc: 0.883347245409015
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_4_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
PCA Training time for case uSc1C2_z-score  =  0.038501739501953125
x_test.shape: (47920, 4)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
PCA Testing Time :  0.006165981292724609
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  0.699134111404419
x_norm_train.shape: (41881, 4)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.4902348518371582
[[    0     0]
 [  668 41213]]
tpr (recall): 0, fnr: 0, fpr: 0.015949953439507177, tnr: 0.9840500465604928, acc: 0.9840500465604928
x_test.shape: (47920, 4)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.5436780452728271
[[13225 22728]
 [  182 11785]]
tpr (recall): 0.3678413484271132, fnr: 0.6321586515728869, fpr: 0.015208490014205732, tnr: 0.9847915099857942, acc: 0.5219115191986644
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_4_features_ROC.pdf

---num_sub_features:6, they are [0, 1, 2, 10, 18, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 6), x_attack_train:0
x_norm_val:(5984, 6), x_attack_val:0
x_norm_test:(11967, 6), x_attack_test:(35953, 6)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 6)
AE training for Case :  uSc1C2_z-score  =  160.57132601737976 s
Train Loss =  0.008651863489664615 model.metrics_names ['loss']
Validation Loss =  0.00790331547925458 model.metrics_names ['loss']
training_losses:{'val_loss': [0.01987909069434207, 0.01279010729525577, 0.012871760479050046, 0.011281048943771717, 0.010811432105374528, 0.011243102239086268, 0.013822618739948394, 0.009235464198325567, 0.01231787392351637, 0.010415054364677738, 0.007407600137300511, 0.005930652091140177, 0.006380033287105156, 0.007295422847407626, 0.005529187625911545, 0.004834814082437698, 0.005245214168799115, 0.00508535254054409, 0.007336214391444934, 0.007335110103093925, 0.004432638757862151, 0.0063930147390981965, 0.0079199005426331, 0.009572708379118678, 0.004398443010252188, 0.006162028683767838, 0.005254973473156837, 0.006930471109076936, 0.006862988927087841, 0.0045137869643625175, 0.006525225349687, 0.005961180391925621, 0.0040984533535426155, 0.005371612834714274, 0.004320337686109989, 0.0066915395891264, 0.007554702503098683, 0.009845081470249331, 0.006458255220802232, 0.005336046060746446, 0.004154655329116127, 0.0075651904982688995, 0.0037743659953980205, 0.006389897659092265, 0.0048392443895280204, 0.004482288293933924, 0.008909731485786285, 0.00747154271578725, 0.006147775435471598, 0.006141593044793064, 0.004821275185325487, 0.004506040409326872, 0.004190999619852014, 0.0058197702304833634, 0.004352303484534436, 0.004367725015991432, 0.008791304178496096, 0.004041936121542345, 0.003977171398131526, 0.005936345953324979, 0.003076609511695364, 0.004219297106118803, 0.005261832455367368, 0.003990424077903085, 0.008330861856055291, 0.004362533682020988, 0.007028002681628985, 0.0058698214822135025, 0.004619332006758945, 0.004036911791887752, 0.007845921358492046, 0.005096423910945694, 0.0038905897822709167, 0.004823866428528479, 0.0072780662193834625, 0.007363313252484814, 0.005764026727706672, 0.0038918977725334505, 0.009015074602383025, 0.0051346135893487995, 0.004777684165314238, 0.008198247796651674, 0.006783080896123606, 0.005969752241324454, 0.003920711088865836, 0.006326619628443318, 0.0037841259708558334, 0.00514073123318706, 0.003965749197395488, 0.003300314517641928, 0.005212981190363114, 0.003638213475478843, 0.0036596864036080195, 0.004268354428732858, 0.003837172378397442, 0.005516940386677011, 0.0031864104760103524, 0.004920620193585435, 0.004271223476246238, 0.00790331547925458], 'loss': [0.10543827339802245, 0.016213517196472724, 0.012692362164836978, 0.011895263260446792, 0.010518246321314708, 0.01038057044123228, 0.009972533853749282, 0.009220507406951597, 0.008971820039035672, 0.008744822431888788, 0.00782684610601494, 0.008125866648415579, 0.007766203230990029, 0.00764988752555468, 0.0075926789719264415, 0.0073075750323448275, 0.006828985404813294, 0.0071949279961487965, 0.007081368757988096, 0.0072153426134356985, 0.006909939222972562, 0.00696425467634237, 0.0070188386735778605, 0.006570945309028939, 0.006459991818657777, 0.006620703232081802, 0.00659897705783093, 0.006805249288462378, 0.007075809324511346, 0.006533019125789979, 0.006393519060293564, 0.006366772183621005, 0.006347690603641395, 0.006171043571007352, 0.00672638781763401, 0.006149786763170366, 0.006114208093914824, 0.006245705023747634, 0.005829435713619968, 0.006041381716653848, 0.006128136699734202, 0.006101189040385015, 0.00570011156973858, 0.005824730787696195, 0.005569673280843027, 0.005918354525540525, 0.005698063252555337, 0.00597102268010818, 0.005906570305532024, 0.005967722891716431, 0.005490234483626533, 0.005816131204317361, 0.005851817857897043, 0.0054962352182266845, 0.005423094040456874, 0.005343438993008842, 0.005642425797970691, 0.0051128073965693915, 0.005876204779743472, 0.005495697151962843, 0.00535319155086643, 0.0055354379293119475, 0.005222913589927068, 0.005623252718722507, 0.005486596499866071, 0.005148673603925688, 0.005693018678891302, 0.00517322772505922, 0.005332053964927574, 0.005279773573099452, 0.005418159179907163, 0.005426469258341416, 0.0050728631487092606, 0.005251692377086176, 0.005277998873061605, 0.005233041284561074, 0.005356344646779769, 0.005536861002069587, 0.005085946627847434, 0.005375365320462274, 0.005318920308853823, 0.005198573122622333, 0.004920040902369592, 0.005330957682611898, 0.00534615464075928, 0.005020713214260167, 0.005223803555478417, 0.005196048600991948, 0.005164895903791931, 0.00499042626779649, 0.004756757371355182, 0.00520378633012734, 0.004950299002197256, 0.005196536460291446, 0.004958538349024117, 0.004858913483131372, 0.005272584231792514, 0.005284150516353385, 0.004907314737670141, 0.0050967167714354835]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 6)
AE Test time for  uSc1C2_z-score  = :  0.5450637340545654
[[    0     0]
 [   19 41862]]
tpr (recall): 0, fnr: 0, fpr: 0.00045366634034526394, tnr: 0.9995463336596547, acc: 0.9995463336596547

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 6), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.5636420249938965
[[30368  5585]
 [    7 11960]]
tpr (recall): 0.8446583038967541, fnr: 0.1553416961032459, fpr: 0.0005849419236232974, tnr: 0.9994150580763767, acc: 0.8833055091819699

save the FPR and FNR reausts of AE with num =6 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_6_features
*the maximize reconstrcution error is 3.0402855355773957 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_6_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 3.0402855355773957 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 64.947857028947 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_6_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 64.947857028947 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 6 features.
*** idx: 0,  thres = 0.000534727782076491
AE Test time for  uSc1C2_z-score  = :  0.5753540992736816
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0002673638910382
AE Test time for  uSc1C2_z-score  = :  0.6450581550598145
[[30368  5585]
 [    7 11960]]
tpr (recall): 0.8446583038967541, fnr: 0.1553416961032459, fpr: 0.0005849419236232974, tnr: 0.9994150580763767, acc: 0.8833055091819699
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  0.5678420066833496
[[30363  5590]
 [    2 11965]]
tpr (recall): 0.8445192334436625, fnr: 0.15548076655633744, fpr: 0.00016712626389237068, tnr: 0.9998328737361076, acc: 0.8833055091819699
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_6_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
PCA Training time for case uSc1C2_z-score  =  0.031131982803344727
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
x_test.shape: (47920, 6)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
PCA Testing Time :  0.01218104362487793
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  1.1366400718688965
x_norm_train.shape: (41881, 6)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.8640258312225342
[[    0     0]
 [ 4168 37713]]
tpr (recall): 0, fnr: 0, fpr: 0.09952006876626633, tnr: 0.9004799312337337, acc: 0.9004799312337337
x_test.shape: (47920, 6)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.9065930843353271
[[14848 21105]
 [ 1150 10817]]
tpr (recall): 0.41298361750062584, fnr: 0.5870163824993742, fpr: 0.09609760173811314, tnr: 0.9039023982618869, acc: 0.5355801335559266
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_6_features_ROC.pdf

---num_sub_features:7, they are [0, 1, 2, 10, 14, 18, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 7), x_attack_train:0
x_norm_val:(5984, 7), x_attack_val:0
x_norm_test:(11967, 7), x_attack_test:(35953, 7)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 7)
AE training for Case :  uSc1C2_z-score  =  183.84865403175354 s
Train Loss =  0.005685912104261153 model.metrics_names ['loss']
Validation Loss =  0.005590798036957329 model.metrics_names ['loss']
training_losses:{'val_loss': [0.03537799934931299, 0.023875745864993428, 0.02125078314208092, 0.018744622302405974, 0.02165823226625269, 0.01611996407964252, 0.02264366722740432, 0.01656115015739585, 0.012683463320235677, 0.021055124137291614, 0.010196869493148384, 0.008846126900198944, 0.018283886939566084, 0.010457786711500609, 0.009592390131145557, 0.00981853396462446, 0.011585864978020681, 0.013471473929756147, 0.009124271315148967, 0.009139228851240586, 0.007946610122042544, 0.012913133570535935, 0.008276069564196993, 0.007479134910954113, 0.008723646066186422, 0.009892008018326313, 0.008291329937005903, 0.007289779341386203, 0.00887649097943051, 0.007145299246275728, 0.006943827080366048, 0.010774048886954147, 0.007370689827799399, 0.009865173312989787, 0.00945337169758856, 0.010720601763556348, 0.009347645222224334, 0.005777012869307303, 0.008921019078038115, 0.01391105189730219, 0.007732069292877686, 0.007673502018187135, 0.007726964080098638, 0.007157169933615123, 0.009453510103577917, 0.009001997973082617, 0.007592218712639601, 0.008353047790055607, 0.007928998184634403, 0.007190985403417107, 0.008827878301714193, 0.007664564725529542, 0.006463369968431917, 0.012903720327219701, 0.009554315784218954, 0.008490639412526618, 0.008583661948236074, 0.006448270855122868, 0.006133903294831594, 0.007751507164143464, 0.010186466826673816, 0.009612245106681145, 0.005789837613203787, 0.005220650115055356, 0.00901420399008747, 0.009744954372651595, 0.00810754393043126, 0.006269112453462287, 0.006019933896268753, 0.007286915000289041, 0.008065027787404902, 0.007299843221843083, 0.0064150312402469906, 0.007926237029845224, 0.0060649292560961635, 0.007473698615489956, 0.007707992638336783, 0.0066050171346607855, 0.01149723626782789, 0.0067096540161513075, 0.009859219240771737, 0.008430938856467047, 0.00726698754096334, 0.004813322824809481, 0.005603502859376411, 0.009981073050655145, 0.006179344871474858, 0.010353642896833744, 0.008110930836874055, 0.009730159083411178, 0.004890596517735226, 0.00565505567514761, 0.006144267486976111, 0.008279217981090919, 0.008270564023405313, 0.007964267803824202, 0.006890320982335803, 0.010782216202447759, 0.006290199891240759, 0.005590798036957329], 'loss': [0.16534961693478806, 0.02643175048281342, 0.02327930448928914, 0.021024356184625167, 0.01985121987937432, 0.017742759629849923, 0.016849188587138037, 0.016268279076825865, 0.014758985504194562, 0.012919143132623665, 0.01273094805994259, 0.012301032711013902, 0.010991909687889488, 0.011381966274835016, 0.0104826129553983, 0.010643754437202802, 0.010429707229444652, 0.010139576413168063, 0.010397432552207736, 0.009756285094255933, 0.010123534605439131, 0.009780689116938026, 0.010192121733140566, 0.009378119545527381, 0.009587983680327162, 0.009409834641994998, 0.009373756767995348, 0.009250605065957384, 0.009363623000151262, 0.009081164211858802, 0.008942433890741239, 0.009091669658498667, 0.008997775080654108, 0.008537037013111629, 0.008891987803951538, 0.008565741169846642, 0.008846073026865662, 0.008961556905002239, 0.009143015760716694, 0.008483693762081636, 0.009146916173326535, 0.008536427512242619, 0.008753140902433159, 0.008529476625033396, 0.008644342219146997, 0.008400124705219517, 0.008337665766662422, 0.008265201870372222, 0.008377199514523362, 0.008297708586736454, 0.008577958273078657, 0.008184739848599638, 0.008386629899352965, 0.008025337750925739, 0.008545821937793885, 0.008253928323638965, 0.008337775456730508, 0.008111652212168483, 0.007913769523878603, 0.007968592722297912, 0.00815464388910022, 0.007911789486820838, 0.00811211304107888, 0.0078099066121203285, 0.007798719272877264, 0.00788959922728277, 0.007769684553956158, 0.007477687105083886, 0.008027941378606056, 0.007838394042313603, 0.007954183965243163, 0.0074576064386554465, 0.0076621701409732715, 0.007900622412911052, 0.0073893355766347715, 0.007638674480621081, 0.007883617319286964, 0.007532009915520663, 0.0076636491796442845, 0.007530747280238177, 0.007476265437760302, 0.007970478049257964, 0.0074014401289966125, 0.007548388379493285, 0.007442885924582141, 0.00761714176877713, 0.007416257281941109, 0.0076561919752404246, 0.007800937033819227, 0.0075126682138392685, 0.007104914510179075, 0.007102196845005951, 0.006953028177593484, 0.007252252724802026, 0.007564990424427052, 0.007145464758682165, 0.007083488661312949, 0.007492943676237288, 0.007319562744940488, 0.007131416351403648]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 7)
AE Test time for  uSc1C2_z-score  = :  0.730802059173584
[[41881]]
tpr (recall): -1, fnr: -1, fpr: -1, tnr: -1, acc: -1

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 7), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.6108710765838623
[[30363  5590]
 [    0 11967]]
tpr (recall): 0.8445192334436625, fnr: 0.15548076655633744, fpr: 0.0, tnr: 1.0, acc: 0.883347245409015

save the FPR and FNR reausts of AE with num =7 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_7_features
*the maximize reconstrcution error is 0.2928466129232969 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_7_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 0.2928466129232969 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 65.7377596598871 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_7_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 65.7377596598871 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 7 features.
*** idx: 0,  thres = 0.0018166932372732287
AE Test time for  uSc1C2_z-score  = :  0.9410271644592285
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0009083466186366
AE Test time for  uSc1C2_z-score  = :  0.707848072052002
[[30363  5590]
 [    0 11967]]
tpr (recall): 0.8445192334436625, fnr: 0.15548076655633744, fpr: 0.0, tnr: 1.0, acc: 0.883347245409015
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  0.6718711853027344
[[30214  5739]
 [    0 11967]]
tpr (recall): 0.8403749339415347, fnr: 0.15962506605846521, fpr: 0.0, tnr: 1.0, acc: 0.880237896494157
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_7_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
PCA Training time for case uSc1C2_z-score  =  0.01859283447265625
x_test.shape: (47920, 7)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
PCA Testing Time :  0.006880998611450195
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207

4). train and evaluate IF...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)
IF Training time for case uSc1C2_z-score  =  1.0881671905517578
x_norm_train.shape: (41881, 7)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.8404848575592041
[[    0     0]
 [ 4169 37712]]
tpr (recall): 0, fnr: 0, fpr: 0.09954394594207397, tnr: 0.9004560540579261, acc: 0.9004560540579261
x_test.shape: (47920, 7)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.8964478969573975
[[15165 20788]
 [ 1156 10811]]
tpr (recall): 0.4218006842266292, fnr: 0.5781993157733708, fpr: 0.09659898052979025, tnr: 0.9034010194702098, acc: 0.5420701168614357
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_7_features_ROC.pdf

---num_sub_features:8, they are [0, 1, 2, 10, 14, 18, 21, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 8), x_attack_train:0
x_norm_val:(5984, 8), x_attack_val:0
x_norm_test:(11967, 8), x_attack_test:(35953, 8)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 8)
AE training for Case :  uSc1C2_z-score  =  169.25804710388184 s
Train Loss =  0.012237306458991216 model.metrics_names ['loss']
Validation Loss =  0.011568666577717678 model.metrics_names ['loss']
training_losses:{'val_loss': [0.04034941004997587, 0.034174230198729484, 0.0296802977000408, 0.0326519546841077, 0.024505722017729666, 0.026179790576511527, 0.023486820716948752, 0.024142134506354995, 0.02338227107224458, 0.023583303778407408, 0.018124079242109615, 0.025181332388942573, 0.019081655954493876, 0.017545275041524738, 0.017396918821701392, 0.017275677864404922, 0.019413930388854788, 0.01746977632616293, 0.016795138151130894, 0.014759905845484632, 0.014342960754638527, 0.015986225149409974, 0.016246076150334136, 0.015681046061217785, 0.016528153762141652, 0.014650387281083806, 0.014522895413665051, 0.014680334391759678, 0.013954117814487315, 0.011661879397072097, 0.014143824203806447, 0.010982419772541777, 0.012533767831158192, 0.010495826407749067, 0.012022736056503606, 0.012003292394353745, 0.012075275782854321, 0.011494622570786246, 0.01202378636674288, 0.01785432707697631, 0.010575210087917706, 0.011011647067983998, 0.009646740794321273, 0.019370257670189288, 0.013627084377993716, 0.010887921070630219, 0.012088340786808633, 0.011153532010328801, 0.010995409620756453, 0.0124245404370408, 0.00906856927801581, 0.010823387901652305, 0.010472120634992333, 0.011635362334987697, 0.009984505611825435, 0.00947771130757217, 0.007147190215833047, 0.017207113408388937, 0.007630495261151921, 0.007157640535394377, 0.010317308041341802, 0.022864917211015436, 0.008388445525863432, 0.011131451651952005, 0.009829809495750914, 0.010494151077965364, 0.008816213615955835, 0.012440343616520338, 0.011505438963618667, 0.009588485207647723, 0.0070516624597503855, 0.007650579945906439, 0.009415709627742436, 0.006378941280259328, 0.006310551264198785, 0.007482589724259501, 0.007581900979546621, 0.008187991743757922, 0.007837289030399711, 0.010340397419248594, 0.009112929651404129, 0.007333995234022007, 0.00749018054236384, 0.006822709787268451, 0.007483555210684551, 0.008912226827665765, 0.007925297382641285, 0.009256035129335476, 0.008681128404158004, 0.0077442480450406435, 0.007930421068726537, 0.007825583361467735, 0.008358447954437152, 0.007776308443676183, 0.013013817185665516, 0.0065613726370614325, 0.007923801083436465, 0.008337814093164024, 0.005645189852638041, 0.011568666577717678], 'loss': [0.20094640141971254, 0.03746672460500651, 0.03280002211849502, 0.03115133290268446, 0.029384452319532524, 0.027538105733819845, 0.02651193156801592, 0.02550078029405541, 0.024710654059484548, 0.02321010130370165, 0.02291515826660736, 0.022282572609743423, 0.02088081743997363, 0.02058847184154856, 0.01962252987591805, 0.01928000344555329, 0.018201973385894864, 0.018051676252868725, 0.01693301132137268, 0.017172688859888947, 0.016800837384572043, 0.016192474164013905, 0.016230959149592508, 0.015945123357492003, 0.015541465604043899, 0.01578118610325793, 0.0151832421744964, 0.01488009536356575, 0.01508187610698363, 0.01484170036082392, 0.014836044574020267, 0.014267525878447113, 0.014350903914346841, 0.013988117919584356, 0.014074840894830548, 0.013605433981609915, 0.013700006626854949, 0.013484135315305014, 0.01355097542653269, 0.012830935557989531, 0.01296069201238809, 0.012922937484935169, 0.012601603783529394, 0.012399211797435132, 0.012293669074841924, 0.012428157647021555, 0.012261539962916478, 0.011663353211801675, 0.011777961520454424, 0.011445940403950295, 0.011482703939417534, 0.01112245021729545, 0.011067543681939114, 0.010618622132831464, 0.010448978777025487, 0.010082381061255802, 0.010134856218444059, 0.009633775654100282, 0.009973975902318346, 0.009647795221867076, 0.009565957306921877, 0.00927408607280578, 0.009949404713666265, 0.009654271879970432, 0.009379522113032942, 0.009351321786978482, 0.008933578687140162, 0.00986683232900473, 0.009139326493751265, 0.009287679501532347, 0.009810367295867777, 0.009129910878259827, 0.009136672232407939, 0.009079999070279149, 0.008681617009312869, 0.009488835147902679, 0.00886724436886153, 0.009197475751748741, 0.009310242020461238, 0.008990631435845303, 0.008600608051079919, 0.008454009148473633, 0.008890462449455436, 0.009014750332673524, 0.008944178246037628, 0.009049972579586228, 0.008808524477930254, 0.008734831200017185, 0.008871891580359994, 0.008698241168237768, 0.00876698288892657, 0.008494585071379302, 0.008535309524925205, 0.00844692765025029, 0.008398048744071353, 0.008200175485041724, 0.008342622511371885, 0.008252500699995946, 0.008706158095488333, 0.00848251696443769]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 8)
AE Test time for  uSc1C2_z-score  = :  0.7731821537017822
[[    0     0]
 [   17 41864]]
tpr (recall): 0, fnr: 0, fpr: 0.000405911988729973, tnr: 0.99959408801127, acc: 0.99959408801127

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 8), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.8152368068695068
[[30371  5582]
 [    5 11962]]
tpr (recall): 0.844741746168609, fnr: 0.15525825383139097, fpr: 0.0004178156597309267, tnr: 0.999582184340269, acc: 0.8834098497495826

save the FPR and FNR reausts of AE with num =8 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_8_features
*the maximize reconstrcution error is 1.9098092570880059 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_8_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 1.9098092570880059 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 67.14333357804378 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_8_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 67.14333357804378 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 8 features.
*** idx: 0,  thres = 0.002269706438835857
AE Test time for  uSc1C2_z-score  = :  0.8280160427093506
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.001134853219418
AE Test time for  uSc1C2_z-score  = :  0.6926040649414062
[[30371  5582]
 [    5 11962]]
tpr (recall): 0.844741746168609, fnr: 0.15525825383139097, fpr: 0.0004178156597309267, tnr: 0.999582184340269, acc: 0.8834098497495826
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  0.7259478569030762
[[30363  5590]
 [    0 11967]]
tpr (recall): 0.8445192334436625, fnr: 0.15548076655633744, fpr: 0.0, tnr: 1.0, acc: 0.883347245409015
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_8_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
PCA Training time for case uSc1C2_z-score  =  0.03672194480895996
x_test.shape: (47920, 8)
PCA Testing Time :  0.013220071792602539
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  1.230090856552124
x_norm_train.shape: (41881, 8)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.7884328365325928
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 8)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.0165717601776123
[[27850  8103]
 [ 1148 10819]]
tpr (recall): 0.7746224237198565, fnr: 0.22537757628014352, fpr: 0.09593047547422077, tnr: 0.9040695245257793, acc: 0.8069490818030051
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_8_features_ROC.pdf

---num_sub_features:10, they are [0, 1, 2, 6, 10, 14, 16, 18, 21, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 10), x_attack_train:0
x_norm_val:(5984, 10), x_attack_val:0
x_norm_test:(11967, 10), x_attack_test:(35953, 10)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 10)
AE training for Case :  uSc1C2_z-score  =  178.43601298332214 s
Train Loss =  0.01316065584446359 model.metrics_names ['loss']
Validation Loss =  0.013088808340184829 model.metrics_names ['loss']
training_losses:{'val_loss': [0.09540940763398925, 0.07115983202017565, 0.06101083810276845, 0.05614223004503046, 0.05006465283944645, 0.0484998467313574, 0.045542287436079854, 0.04474790484948273, 0.03827546020959788, 0.03723308912174587, 0.03508885252603235, 0.0348976041603694, 0.03488971902565523, 0.031719355385770455, 0.03302173953961561, 0.03613952853104329, 0.03364091362545197, 0.032387296116368015, 0.02834132178263231, 0.02776265254911573, 0.028024577844469625, 0.02582724810264168, 0.024200058497368972, 0.023495734206097012, 0.025943415612978412, 0.026424665023936308, 0.025033745825051624, 0.024205416301514376, 0.02311497358953889, 0.02354117092442385, 0.022497122166030867, 0.021078965103721873, 0.032178370491228, 0.02248130405052779, 0.023889948499393972, 0.022503335412372562, 0.023103653388546114, 0.020623232098545302, 0.022657933002487224, 0.020835334723964732, 0.022840229002509843, 0.01869629585946148, 0.01868060764104606, 0.019331986497948195, 0.02699191594386802, 0.01899650217815835, 0.019173630558073838, 0.019290325087420443, 0.019907031666467533, 0.01908695929868017, 0.0184681547984959, 0.020570676265792412, 0.018714767741288413, 0.020355267405390422, 0.01753845141035191, 0.017102161596683575, 0.01919821268296178, 0.017968061076287917, 0.022079761473730922, 0.016069369896110845, 0.01738635271807565, 0.022485673283152083, 0.016367427740783935, 0.02205838916454723, 0.017571358851849395, 0.016541909715310138, 0.017299796613979148, 0.019058284902556694, 0.016699043954199647, 0.01723216511906787, 0.016576697566810458, 0.016231518557524298, 0.015561619009025753, 0.015072830392416308, 0.018010994541473726, 0.01874569054434006, 0.01474275097081607, 0.018411233503232028, 0.016744837154918178, 0.014919250658190346, 0.01573935288059361, 0.017847856840387703, 0.014867444612324875, 0.017236392387253715, 0.018900692433039136, 0.01669763860835589, 0.016268650752138646, 0.015060989694161848, 0.013942803243762828, 0.018589424870828576, 0.01520922525541827, 0.014599926060035745, 0.014920750971544872, 0.01518395380739541, 0.013965803736392508, 0.014869195229827083, 0.01645611389913661, 0.014323644656289549, 0.016082452176845966, 0.013088808340184829], 'loss': [0.3532676354090841, 0.08747167438012488, 0.07059938290348176, 0.06096558588217626, 0.054454590396398384, 0.04994218960994665, 0.046412832041071495, 0.04300501999846844, 0.04189120077210666, 0.03957440080389565, 0.0383505426028461, 0.03676223522671479, 0.03571083270258299, 0.03507788067643595, 0.03391693499306548, 0.03316690086669446, 0.03216320998832024, 0.031253460672693155, 0.030594611035915684, 0.03030249698308212, 0.029359425421325552, 0.028593543419891378, 0.027959284947040797, 0.02845208849759244, 0.027420694025592343, 0.026570223942525333, 0.026220030072920914, 0.02641590854741393, 0.026196027913872814, 0.025197949119844232, 0.024848382740793717, 0.02468687998364988, 0.024933894457392625, 0.024101496922800742, 0.02380975389383956, 0.02355449600488788, 0.023429951921464028, 0.022868339144002457, 0.023191578440603537, 0.022568635431851853, 0.022475096009793905, 0.021959822853210464, 0.021691922958539018, 0.021767028477450746, 0.021738575536935874, 0.021468992229467552, 0.021309915519575673, 0.021145129868168435, 0.02111674351887433, 0.020806551078081256, 0.02065492966817522, 0.020349926068702482, 0.020289728619996707, 0.019808458397804266, 0.019821796678702232, 0.019845236429323725, 0.01972530233415998, 0.019177469847212962, 0.019163038439157242, 0.0192935708297143, 0.019443641405209548, 0.01868170762782794, 0.01869623607262001, 0.018408286486173514, 0.018557234071969873, 0.018080808774847596, 0.017895965734272337, 0.018156623073290124, 0.017936505238998535, 0.01812593636068351, 0.01773710313522021, 0.01776940759214189, 0.01764609802100967, 0.017360005997832394, 0.0177167506405469, 0.017486373738232898, 0.01716843098432266, 0.01725861682762243, 0.017448681378012823, 0.017099656184237255, 0.01702543559306574, 0.016822685037417646, 0.016763155523718112, 0.016428083645007797, 0.01675669209054653, 0.01669689804163108, 0.016451128594000386, 0.01698550376810278, 0.01607634153433491, 0.01600635157470355, 0.01601863772749569, 0.01565950428031422, 0.01606821162671378, 0.015615941900134177, 0.015480907751336103, 0.015619240393878362, 0.015144832095596528, 0.01557055147714885, 0.015475802392751994, 0.015354679292527087]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 10)
AE Test time for  uSc1C2_z-score  = :  0.6793889999389648
[[    0     0]
 [    4 41877]]
tpr (recall): 0, fnr: 0, fpr: 9.550870323058189e-05, tnr: 0.9999044912967694, acc: 0.9999044912967694

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 10), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.8664419651031494
[[30409  5544]
 [    2 11965]]
tpr (recall): 0.8457986816121047, fnr: 0.1542013183878953, fpr: 0.00016712626389237068, tnr: 0.9998328737361076, acc: 0.8842654424040067

save the FPR and FNR reausts of AE with num =10 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_10_features
*the maximize reconstrcution error is 1.2429605786227145 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_10_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 1.2429605786227145 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 71.13645134484644 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_10_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 71.13645134484644 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 10 features.
*** idx: 0,  thres = 0.0034816238389434773
AE Test time for  uSc1C2_z-score  = :  0.827336311340332
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0017408119194717
AE Test time for  uSc1C2_z-score  = :  0.815540075302124
[[30406  5547]
 [    2 11965]]
tpr (recall): 0.8457152393402497, fnr: 0.15428476065975022, fpr: 0.00016712626389237068, tnr: 0.9998328737361076, acc: 0.884202838063439
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  0.7786698341369629
[[30366  5587]
 [    0 11967]]
tpr (recall): 0.8446026757155175, fnr: 0.15539732428448252, fpr: 0.0, tnr: 1.0, acc: 0.8834098497495826
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_10_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
PCA Training time for case uSc1C2_z-score  =  0.03712892532348633
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
x_test.shape: (47920, 10)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
PCA Testing Time :  0.012197732925415039
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,

/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
4). train and evaluate IF...
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)
IF Training time for case uSc1C2_z-score  =  1.3233561515808105
x_norm_train.shape: (41881, 10)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.8551359176635742
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 10)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.0259721279144287
[[27111  8842]
 [ 1165 10802]]
tpr (recall): 0.7540678107529274, fnr: 0.24593218924707258, fpr: 0.09735104871730592, tnr: 0.9026489512826941, acc: 0.7911727879799666
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_10_features_ROC.pdf

---num_sub_features:11, they are [0, 1, 2, 6, 10, 11, 14, 16, 18, 21, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 11), x_attack_train:0
x_norm_val:(5984, 11), x_attack_val:0
x_norm_test:(11967, 11), x_attack_test:(35953, 11)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 11)
AE training for Case :  uSc1C2_z-score  =  192.25494718551636 s
Train Loss =  0.01689388824994209 model.metrics_names ['loss']
Validation Loss =  0.016945752374987234 model.metrics_names ['loss']
training_losses:{'val_loss': [0.11857534082417182, 0.08722468999458506, 0.08104344790074278, 0.07088059294510653, 0.06583071171360858, 0.06111557839468201, 0.05588013842144114, 0.05291322221292213, 0.04678760206994207, 0.04791216326150346, 0.04552924265477428, 0.042034018077553914, 0.04065321254379609, 0.039740196982010166, 0.03635449862894528, 0.035957463374510806, 0.033066563656862405, 0.03142740803068494, 0.03318439928047797, 0.039050289633917934, 0.03340886898816907, 0.042417148915044764, 0.03276534150927303, 0.0311199696933761, 0.029156523198885394, 0.028647628463406294, 0.02967700975782731, 0.028968322065902902, 0.03139519687981051, 0.025260692776086176, 0.027044668728933935, 0.05047431532393165, 0.02659041007711766, 0.030784959969593878, 0.028834381125827525, 0.025139358482338527, 0.024273049579385447, 0.027738831190262887, 0.03147225652666972, 0.02585018468014697, 0.023366142582287763, 0.024359498048490063, 0.0258138009650822, 0.0266686047721196, 0.02744142886470346, 0.02870760934258049, 0.028308315117928116, 0.025140174938475385, 0.023357441270335472, 0.027880325156418397, 0.03157735797252884, 0.023624253962288566, 0.02036550653510712, 0.02204942684819832, 0.02448097168203981, 0.02201811406004397, 0.024420854242090236, 0.023176966230061283, 0.02377860931390747, 0.01981394000869384, 0.023402604911934563, 0.020892246008756006, 0.02345881484110247, 0.021469739435071297, 0.01901073509299341, 0.02134151996815587, 0.022021324901697153, 0.021916727321272228, 0.021193673754519318, 0.0204700353669929, 0.022595908642213614, 0.016760041030811117, 0.017387342813579156, 0.025667779605815753, 0.021000955522777563, 0.0274223726202938, 0.018389543593129054, 0.017821218713839106, 0.01892152801156044, 0.022312650651257624, 0.01988562298091975, 0.02575179094319197, 0.022899422500740715, 0.01877149533141743, 0.018969684361136534, 0.03276721774077511, 0.018889696292459648, 0.017367219333263004, 0.015765664282249896, 0.017123432262217936, 0.02115654146029828, 0.01759801749239631, 0.0185604741258975, 0.020940585370688516, 0.020727316560074288, 0.016767620338117056, 0.01756296023467486, 0.016674002851633465, 0.02044838207729041, 0.016945752374987234], 'loss': [0.3619781229721066, 0.10511778970415221, 0.08669459880955316, 0.07620118287502503, 0.06841991592645759, 0.06246092803912357, 0.05782691434624216, 0.05499005249472685, 0.0519086324009919, 0.04827985766115106, 0.04534338254613466, 0.04278332224357538, 0.04143324252326082, 0.040096515635523175, 0.038879115289383016, 0.03828549466681886, 0.037065088366138095, 0.0365573083976757, 0.0350196677914346, 0.03472104274162189, 0.03394109159824547, 0.03289113835627124, 0.033537703660161525, 0.03180279753219318, 0.03172027758110267, 0.030872583543342606, 0.030822104620421825, 0.030436176840088813, 0.0301639884769908, 0.029830453508483703, 0.028983697793083234, 0.02867533890222035, 0.029217351700764855, 0.02858230161399951, 0.028679952953822994, 0.027976358047521094, 0.027914269419673357, 0.0276543266538618, 0.027551517599719477, 0.02713244191448135, 0.02645628723198237, 0.02659925656795533, 0.026764993489287434, 0.02620889850968423, 0.02662075326671767, 0.025820688558973005, 0.02573006275600703, 0.025146180421874664, 0.025408642542648345, 0.025292565661234633, 0.02531159146885479, 0.02448609547951024, 0.02419883525022372, 0.02482813203942653, 0.02384422483140021, 0.023646435358012915, 0.023662093256502068, 0.023525748604151225, 0.0229525329256366, 0.02317268783453208, 0.02276782106369501, 0.022881315357210854, 0.022696017488363675, 0.022000698101870716, 0.02241133792255451, 0.02210430164128152, 0.021689369123805226, 0.021822988619252127, 0.021215282505643775, 0.021844114260207884, 0.021689868453556613, 0.02122006908067837, 0.02127697420423717, 0.021611370258973472, 0.020942972818928703, 0.02088902462951186, 0.02069911971284974, 0.020658075148895956, 0.02042429247986987, 0.020325936201551303, 0.020614648203756816, 0.020044180562025053, 0.02006397577640545, 0.019843349406187347, 0.01984282906213752, 0.01942226414004494, 0.019550717579119165, 0.019441017235596637, 0.019365760779651773, 0.01923775875019003, 0.019396629537391272, 0.018622294884714185, 0.019100753385747522, 0.018552892473570663, 0.018832600946263052, 0.018426876475111716, 0.018624445730781827, 0.018486500696373906, 0.018445979241462403, 0.0180941550693537]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 11)
AE Test time for  uSc1C2_z-score  = :  0.680060863494873
[[    0     0]
 [    4 41877]]
tpr (recall): 0, fnr: 0, fpr: 9.550870323058189e-05, tnr: 0.9999044912967694, acc: 0.9999044912967694

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 11), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.815936803817749
[[30512  5441]
 [    1 11966]]
tpr (recall): 0.8486635329457903, fnr: 0.15133646705420967, fpr: 8.356313194618534e-05, tnr: 0.9999164368680538, acc: 0.8864357262103506

save the FPR and FNR reausts of AE with num =11 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_11_features
*the maximize reconstrcution error is 1.0144317652302124 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_11_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 1.0144317652302124 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 66.80058215173972 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_11_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 66.80058215173972 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 11 features.
*** idx: 0,  thres = 0.004932738098330156
AE Test time for  uSc1C2_z-score  = :  0.8328518867492676
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.002466369049165
AE Test time for  uSc1C2_z-score  = :  0.789837121963501
[[30511  5442]
 [    1 11966]]
tpr (recall): 0.8486357188551721, fnr: 0.15136428114482797, fpr: 8.356313194618534e-05, tnr: 0.9999164368680538, acc: 0.8864148580968281
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  0.8255422115325928
[[26658  9295]
 [    0 11967]]
tpr (recall): 0.7414680277028343, fnr: 0.25853197229716574, fpr: 0.0, tnr: 1.0, acc: 0.8060308848080133
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_11_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
PCA Training time for case uSc1C2_z-score  =  0.04359316825866699
x_test.shape: (47920, 11)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
PCA Testing Time :  0.017835140228271484
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  1.2807660102844238
x_norm_train.shape: (41881, 11)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.871373176574707
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 11)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.8949270248413086
[[28139  7814]
 [ 1136 10831]]
tpr (recall): 0.7826606959085473, fnr: 0.21733930409145272, fpr: 0.09492771789086656, tnr: 0.9050722821091335, acc: 0.8132303839732888
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_11_features_ROC.pdf

---num_sub_features:13, they are [0, 1, 2, 6, 7, 8, 10, 11, 14, 16, 18, 21, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 13), x_attack_train:0
x_norm_val:(5984, 13), x_attack_val:0
x_norm_test:(11967, 13), x_attack_test:(35953, 13)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 13)
AE training for Case :  uSc1C2_z-score  =  192.56121182441711 s
Train Loss =  0.025121434833163744 model.metrics_names ['loss']
Validation Loss =  0.025947253498682044 model.metrics_names ['loss']
training_losses:{'val_loss': [0.17637566720100648, 0.13290877755791108, 0.11623517583238888, 0.1128029744813149, 0.09854096459115252, 0.09257465320076534, 0.08911632200613379, 0.08519536722949482, 0.08481664282274756, 0.07689033649901655, 0.07646027856810207, 0.08005167559825163, 0.07193240680716892, 0.07263556515230214, 0.0692446924307767, 0.06258535721802456, 0.06598447175586925, 0.06131060927468825, 0.05968348145046655, 0.059125973579080345, 0.05955599192629524, 0.05556930659368714, 0.052716499274188186, 0.05085056667579686, 0.050739684804556845, 0.04704121386702048, 0.04594514884532773, 0.042501368873658026, 0.045384467873264125, 0.04622599745497984, 0.043480882869366015, 0.04300996188054429, 0.04065616013492174, 0.04002506219169354, 0.03849698741606531, 0.040084469794509886, 0.03483146608353936, 0.04158644195905025, 0.03671146406328933, 0.03814438206547084, 0.03807102674668167, 0.03953938502917953, 0.04001161791782647, 0.037374127088463244, 0.032953120150508726, 0.038149024076002805, 0.03777502083722602, 0.03429086764348063, 0.03755318003900867, 0.03225579902151211, 0.035583749941405764, 0.03573747511136341, 0.033716122714434076, 0.029842451105222982, 0.028304563840243588, 0.02867195571468954, 0.03180175965880965, 0.0355723964717777, 0.029354432363680658, 0.030563490868690497, 0.02926461556976173, 0.03291874642877336, 0.030686782224771173, 0.02505188313795921, 0.028973634105753453, 0.027869126958682894, 0.030054970201164644, 0.02854048330735236, 0.0311909474053963, 0.026848814694240768, 0.028018847785212776, 0.02710320516663758, 0.025162509936381153, 0.029177436012436043, 0.026929944270554392, 0.031083805436756522, 0.03165515600877968, 0.03006205977722604, 0.029597985847071212, 0.03021025973905057, 0.027449482543901962, 0.030893229535795787, 0.024792951481904895, 0.0282583190526634, 0.02498520518787564, 0.028046931259652828, 0.03125601392338939, 0.027699199241192584, 0.024380393480672873, 0.02783989882405429, 0.02910653358813435, 0.02361072987855915, 0.02807381006585245, 0.02566017364375891, 0.026781747944374136, 0.025830938107269334, 0.025694547260907245, 0.02799445592404846, 0.02529934746895563, 0.025947253498682044], 'loss': [0.4865783824276746, 0.1582601901671882, 0.12822369694324093, 0.11402266531871727, 0.10651772005837927, 0.09996580431963066, 0.094402762700202, 0.09048570975611822, 0.08651809908860773, 0.08371859195344127, 0.08025229467296836, 0.0781562248248573, 0.0751882309922146, 0.07363639566776507, 0.07156444277043034, 0.06951024948722331, 0.06749167368721476, 0.06527324197000203, 0.06268576031052159, 0.06084619738277732, 0.059461839835452945, 0.05759356386203661, 0.05553426063118969, 0.054092877063490974, 0.05157089727850426, 0.050594368324173675, 0.04839895684111497, 0.04760663985739248, 0.046519805198754004, 0.04555341558498149, 0.04454962019780905, 0.04363872179672713, 0.04272432029065827, 0.042201796383044915, 0.04108674773260916, 0.04013026416492435, 0.0401402176249621, 0.039099604432096154, 0.038771005310323674, 0.03799314740575139, 0.037176733719118414, 0.03697541221363952, 0.036285845021602973, 0.03574252240819652, 0.0347279025479361, 0.035362950113208, 0.034420582656290395, 0.034224714001323174, 0.0338760479756865, 0.03350016361660219, 0.03384838248305177, 0.03256719730080522, 0.03264504398893813, 0.03238501145782671, 0.032085247400483005, 0.03185028969283206, 0.031101966609302246, 0.031303228872649684, 0.031140178289008356, 0.03050848971555553, 0.03065045262972191, 0.02987784693647675, 0.030219958500226768, 0.02919351419394858, 0.029535839582565993, 0.028893586067414205, 0.02919381035319307, 0.02878688828309983, 0.02874188009748338, 0.028530074550729152, 0.028053485537767736, 0.028492540423284116, 0.028151855863866843, 0.027740767222999122, 0.02755769531463967, 0.02730616042278167, 0.027753146203975163, 0.027157910390677883, 0.02719289097149627, 0.026831869759029008, 0.026783905582423453, 0.026638011129046006, 0.026644202252067047, 0.026531866628260636, 0.026147517671338102, 0.02565277080514783, 0.026372080179273946, 0.025456540542670814, 0.02547830918468961, 0.02569348853227253, 0.025954721020207967, 0.02541876329985091, 0.02589392632099073, 0.025325756920483132, 0.025182329395173557, 0.0250403977455467, 0.02525569100859495, 0.02514088134648276, 0.024364616524801094, 0.02495474002765078]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 13)
AE Test time for  uSc1C2_z-score  = :  0.7955770492553711
[[    0     0]
 [   20 41861]]
tpr (recall): 0, fnr: 0, fpr: 0.00047754351615290945, tnr: 0.9995224564838471, acc: 0.9995224564838471

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 13), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.8825099468231201
[[30452  5501]
 [   14 11953]]
tpr (recall): 0.8469946875086919, fnr: 0.1530053124913081, fpr: 0.0011698838472465947, tnr: 0.9988301161527534, acc: 0.8849123539232053

save the FPR and FNR reausts of AE with num =13 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_13_features
*the maximize reconstrcution error is 1.354636867961241 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_13_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 1.354636867961241 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 70.83610180916124 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_13_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 70.83610180916124 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 13 features.
*** idx: 0,  thres = 0.005355308784147458
AE Test time for  uSc1C2_z-score  = :  1.2912647724151611
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0026776543920737
AE Test time for  uSc1C2_z-score  = :  1.2252299785614014
[[30452  5501]
 [   14 11953]]
tpr (recall): 0.8469946875086919, fnr: 0.1530053124913081, fpr: 0.0011698838472465947, tnr: 0.9988301161527534, acc: 0.8849123539232053
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  1.284864902496338
[[30018  5935]
 [    0 11967]]
tpr (recall): 0.8349233721803465, fnr: 0.16507662781965343, fpr: 0.0, tnr: 1.0, acc: 0.8761477462437396
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_13_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
PCA Training time for case uSc1C2_z-score  =  0.03847980499267578
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
x_test.shape: (47920, 13)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
PCA Testing Time :  0.015413999557495117
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  1.7984302043914795
x_norm_train.shape: (41881, 13)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.9749088287353516
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 13)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.0226600170135498
[[27284  8669]
 [ 1135 10832]]
tpr (recall): 0.7588796484298946, fnr: 0.24112035157010542, fpr: 0.09484415475892037, tnr: 0.9051558452410796, acc: 0.7954090150250417
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_13_features_ROC.pdf

---num_sub_features:15, they are [0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 21, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 15), x_attack_train:0
x_norm_val:(5984, 15), x_attack_val:0
x_norm_test:(11967, 15), x_attack_test:(35953, 15)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 15)
AE training for Case :  uSc1C2_z-score  =  200.37860417366028 s
Train Loss =  0.03037673116201006 model.metrics_names ['loss']
Validation Loss =  0.030840751929158833 model.metrics_names ['loss']
training_losses:{'val_loss': [0.28571002775016313, 0.22211622227640712, 0.19419581319559068, 0.16832119357936523, 0.15718040041585657, 0.1397958185503827, 0.13258791053518254, 0.12380538466461202, 0.11501378930587182, 0.11323705578551573, 0.10260223852281264, 0.10081071432500599, 0.08995313193390077, 0.09270158414056594, 0.08731132552505814, 0.08469183886433668, 0.0845552346006753, 0.07655512009632778, 0.0845744895106331, 0.07748768932838491, 0.07172415819875697, 0.07413706510143483, 0.07462734856548156, 0.06886417860972052, 0.06686370813830651, 0.06505854933816481, 0.06665288196767077, 0.06242721709099045, 0.05795082635181473, 0.05766358081111934, 0.05750378596790653, 0.05791588842789119, 0.05644514445554127, 0.05122684009054446, 0.05515157030945156, 0.05833768262901408, 0.04826858046061215, 0.053632083782218995, 0.05096825044900976, 0.04829766769659392, 0.04503089662661208, 0.05723128501664509, 0.050190474738411726, 0.04582998027058846, 0.0487140594598125, 0.04462002303431378, 0.04659238645936397, 0.046091051642748126, 0.041920382718749864, 0.04429294872172376, 0.04306511416593019, 0.042248113728302686, 0.04780376200529343, 0.040575522670452606, 0.040977047935606324, 0.04337479446063386, 0.046465403763925966, 0.03824647834753608, 0.04366115268499137, 0.03795422446281515, 0.041925539446865175, 0.04244579897725327, 0.04170108075567427, 0.03541647507385774, 0.04378125125313188, 0.04633431003135156, 0.044158443758752254, 0.03807319562264624, 0.03905278472180035, 0.04397960472353958, 0.03762595863504843, 0.03450935844949541, 0.038553861114271185, 0.043521306880894194, 0.034295384836866255, 0.037020790106791227, 0.03373478341070726, 0.040135707208179536, 0.03430873070928184, 0.03864247008241753, 0.035855784165588295, 0.04201215012546848, 0.035073971355901686, 0.03577489290326674, 0.03247481997916724, 0.03153148412027142, 0.03366170999877912, 0.03545394079650149, 0.03918555814195125, 0.03256763434186976, 0.03390810187447836, 0.03499192070156176, 0.03311969366741371, 0.035112129613996186, 0.029968356663849265, 0.03233585311448511, 0.031224668314829868, 0.036985089414738076, 0.02971834575827109, 0.030840751929158833], 'loss': [0.7092051970219647, 0.2591638538862538, 0.21456778253198727, 0.1875779707473891, 0.16625685119753578, 0.15216769544186107, 0.14137088739838677, 0.1306439979728463, 0.12306480406675914, 0.11582303139776513, 0.10861324723716116, 0.10265122070424305, 0.09854943590265687, 0.0938857096455272, 0.09018361795058448, 0.08800583807233184, 0.08505285562307979, 0.08271115030120697, 0.08045448106528467, 0.07837650405456473, 0.07646739103670508, 0.07540505909683631, 0.0732089039942078, 0.07128978812697183, 0.06974207708038672, 0.06858625889926724, 0.06686605648565809, 0.06464490547695456, 0.06258362266023465, 0.061043177931093304, 0.06021091672223726, 0.05809071552893348, 0.05674716575200059, 0.055477524368415174, 0.05441912756802937, 0.05323813721894811, 0.05298140714220908, 0.0515592042167712, 0.05011332702745664, 0.04956124080333694, 0.04937054442873284, 0.048200143129576364, 0.04876243170744035, 0.047176411997471114, 0.046289590842194105, 0.04601204285770779, 0.04598762133596352, 0.045659636495890776, 0.04505537814757096, 0.044175042184381744, 0.04392429289074534, 0.043788530646451385, 0.04292315057302747, 0.04254533805052544, 0.04231253437837894, 0.04197562594842963, 0.041615844007269885, 0.04158405463001607, 0.04096955494440476, 0.040385952215675626, 0.040255517508717274, 0.039582995885405786, 0.03924280604762669, 0.038978948763207365, 0.03872232900642056, 0.03866072571853868, 0.03857201399242795, 0.03860342886553023, 0.03833132846837444, 0.038180325306600295, 0.037225532412297015, 0.03721258718310393, 0.03698369445891346, 0.037147421210051434, 0.03719040838547583, 0.036831279586323616, 0.03623315906187042, 0.03627711799942956, 0.03633713336815652, 0.03594290320538127, 0.03567839484115757, 0.036102938215047904, 0.03503373864309572, 0.034823020612436945, 0.034881260976491, 0.035233626239054586, 0.03480010836633737, 0.03482029989526497, 0.03425218252482608, 0.034523426016530655, 0.034105237050807445, 0.034776299768124276, 0.03395754272641545, 0.0338374796268085, 0.033769538486468687, 0.03298529276846651, 0.03275904776306771, 0.03350201110486067, 0.03211169681287867, 0.031371939651863225]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 15)
AE Test time for  uSc1C2_z-score  = :  0.9661188125610352
[[    0     0]
 [   34 41847]]
tpr (recall): 0, fnr: 0, fpr: 0.000811823977459946, tnr: 0.9991881760225401, acc: 0.9991881760225401

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 15), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  0.9861588478088379
[[30410  5543]
 [   14 11953]]
tpr (recall): 0.845826495702723, fnr: 0.154173504297277, fpr: 0.0011698838472465947, tnr: 0.9988301161527534, acc: 0.8840358931552588

save the FPR and FNR reausts of AE with num =15 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_15_features
*the maximize reconstrcution error is 1.7179922838403143 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_15_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 1.7179922838403143 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 73.10693701232728 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_15_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 73.10693701232728 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 15 features.
*** idx: 0,  thres = 0.006126037654207751
AE Test time for  uSc1C2_z-score  = :  1.4079201221466064
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.003063018827104
AE Test time for  uSc1C2_z-score  = :  1.0791361331939697
[[30409  5544]
 [   14 11953]]
tpr (recall): 0.8457986816121047, fnr: 0.1542013183878953, fpr: 0.0011698838472465947, tnr: 0.9988301161527534, acc: 0.8840150250417362
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  1.3092732429504395
[[27757  8196]
 [    0 11967]]
tpr (recall): 0.7720357132923539, fnr: 0.2279642867076461, fpr: 0.0, tnr: 1.0, acc: 0.8289649415692821
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_15_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
PCA Training time for case uSc1C2_z-score  =  0.0662989616394043
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
x_test.shape: (47920, 15)
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
PCA Testing Time :  0.029925107955932617
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207

4). train and evaluate IF...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)
IF Training time for case uSc1C2_z-score  =  1.6500968933105469
x_norm_train.shape: (41881, 15)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.9992749691009521
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 15)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.0673038959503174
[[20144 15809]
 [ 1154 10813]]
tpr (recall): 0.5602870414151809, fnr: 0.43971295858481907, fpr: 0.09643185426589788, tnr: 0.9035681457341022, acc: 0.6460141903171953
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_15_features_ROC.pdf

---num_sub_features:16, they are [0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 21, 23, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 16), x_attack_train:0
x_norm_val:(5984, 16), x_attack_val:0
x_norm_test:(11967, 16), x_attack_test:(35953, 16)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 16)
AE training for Case :  uSc1C2_z-score  =  229.25607109069824 s
Train Loss =  0.03996099076229557 model.metrics_names ['loss']
Validation Loss =  0.041102620738155064 model.metrics_names ['loss']
training_losses:{'val_loss': [0.283883215749965, 0.21727046171292902, 0.1848799535297455, 0.16892216840689195, 0.15253527263269068, 0.15409768372774124, 0.13651987663246093, 0.1297531814817439, 0.12480956021158453, 0.12402418498846299, 0.11546944113657437, 0.11304387772943884, 0.11155863428976447, 0.10519822957840833, 0.1121140186958772, 0.1001189419810466, 0.10498361560431393, 0.09736701975611442, 0.09628713439731675, 0.09277179343177673, 0.0926149841298394, 0.09117026401952626, 0.08724036278890417, 0.08432507180275127, 0.08536123840965051, 0.08240522007970887, 0.08119339758858961, 0.07786076627472505, 0.07672668638873227, 0.07587607003708574, 0.07393938422521805, 0.0753152194547462, 0.08033913712609898, 0.067976888149658, 0.06863797005803828, 0.06671082714502824, 0.07349299183264774, 0.06843477427800071, 0.07416084221499489, 0.06964525514665772, 0.06450236799882696, 0.06600296953543622, 0.07073988833210686, 0.06554197035929099, 0.06657611620537737, 0.061641481670147595, 0.062016842996372896, 0.06541401227527761, 0.06289264093586468, 0.07691767327686683, 0.06390538130373878, 0.05819343863164678, 0.057443057092275214, 0.06078648011394363, 0.055704700237608214, 0.058986051137593976, 0.05379785861282106, 0.058779840382503314, 0.054810023831731496, 0.05235893018344507, 0.05308940918010505, 0.053993288726411404, 0.054457724861362404, 0.057353790132279064, 0.051228712955340344, 0.05219927096470473, 0.05530025515167471, 0.04850045334607522, 0.05136223772869391, 0.04808942274374758, 0.051038731148536194, 0.05006429159585486, 0.04784246498250706, 0.04863529099539958, 0.050521184057794155, 0.04678602632194917, 0.04632889314051618, 0.045400996259189544, 0.0613760106504601, 0.04181690469264666, 0.044446414137348775, 0.04616686278446154, 0.04293580953888396, 0.044925248439617975, 0.04864833412323406, 0.04130690765970531, 0.04721195365297284, 0.04327202305436772, 0.050702397656791354, 0.04111421665047261, 0.04498058606317655, 0.043949135006430315, 0.04367143300207541, 0.04360786774619059, 0.04387865296221353, 0.04330076237413335, 0.04543348227473185, 0.04635383519418737, 0.04486739743042757, 0.041102620738155064], 'loss': [0.6683844741171369, 0.2551591657024722, 0.20474720971018345, 0.1805050610259219, 0.1655728484969953, 0.154190020543528, 0.14568114420422418, 0.13828399174726783, 0.13204396417902312, 0.1270661033432556, 0.12286045990101727, 0.11889213915088935, 0.11631889001222769, 0.11146859711460419, 0.1081476017140018, 0.10513312239985745, 0.10265263079008644, 0.10060820079102978, 0.09823294832673804, 0.0965071028640922, 0.09420987236853022, 0.09152396647324748, 0.08944661854692147, 0.0874341258980683, 0.08632669466912828, 0.08408000024848526, 0.08256383384890253, 0.0810266077879242, 0.07940264456266746, 0.07801007155884657, 0.07721531833097844, 0.07618882487819358, 0.07576492470879359, 0.07407472018921976, 0.07273336364450579, 0.07277637663251568, 0.07198943939476345, 0.0708060468662258, 0.07010462891911484, 0.06936865061146519, 0.06876137710527602, 0.06841615905146843, 0.06761146284029108, 0.06768913365186609, 0.06585907470348179, 0.06551752353561123, 0.06482643554729117, 0.06455271022202125, 0.06302862478336214, 0.06282797277977785, 0.061607845943337604, 0.061179690520911295, 0.06107898212097421, 0.05977181785897554, 0.05948848767423866, 0.058178888465332576, 0.05868024209441811, 0.05756638722095707, 0.05723163286173618, 0.05654240284347323, 0.05556973711640658, 0.05518264958518404, 0.05507408033571918, 0.05469883050330958, 0.053664679424161886, 0.053861514291843486, 0.052195433550091215, 0.05199310204321458, 0.051053567552378096, 0.05116341874449581, 0.04976461630598604, 0.04990057065810413, 0.04980382573355241, 0.048729590776560486, 0.04799879622463752, 0.04802833058976978, 0.04724042811258762, 0.04724022764311855, 0.04630084776228101, 0.04619216920448557, 0.04665638579021911, 0.045734308180681985, 0.045231814630643956, 0.0452595405931344, 0.044674620993319925, 0.04484784678832635, 0.04448218275094533, 0.04424158947632638, 0.043636962169228195, 0.04343241861412995, 0.04352970251705502, 0.043147576880112455, 0.04318408504596686, 0.04261776231911903, 0.04196931780169503, 0.04196570124004382, 0.042190486717113396, 0.04258140439802673, 0.04174161180866297, 0.041298917918580445]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 16)
AE Test time for  uSc1C2_z-score  = :  1.1140329837799072
[[    0     0]
 [   68 41813]]
tpr (recall): 0, fnr: 0, fpr: 0.001623647954919892, tnr: 0.9983763520450801, acc: 0.9983763520450801

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 16), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  1.1694328784942627
[[31872  4081]
 [   28 11939]]
tpr (recall): 0.8864906961866882, fnr: 0.11350930381331183, fpr: 0.0023397676944931895, tnr: 0.9976602323055068, acc: 0.9142529215358931

save the FPR and FNR reausts of AE with num =16 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_16_features
*the maximize reconstrcution error is 1.840222316294065 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_16_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 1.840222316294065 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 92.39030804093846 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_16_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 92.39030804093846 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 16 features.
*** idx: 0,  thres = 0.004348773337181626
AE Test time for  uSc1C2_z-score  = :  1.3074288368225098
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0021743866685908
AE Test time for  uSc1C2_z-score  = :  1.1305809020996094
[[31854  4099]
 [   28 11939]]
tpr (recall): 0.8859900425555587, fnr: 0.11400995744444135, fpr: 0.0023397676944931895, tnr: 0.9976602323055068, acc: 0.9138772954924875
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  1.0444998741149902
[[30549  5404]
 [    0 11967]]
tpr (recall): 0.8496926542986677, fnr: 0.1503073457013323, fpr: 0.0, tnr: 1.0, acc: 0.887228714524207
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_16_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
PCA Training time for case uSc1C2_z-score  =  0.06090426445007324
x_test.shape: (47920, 16)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
PCA Testing Time :  0.02697920799255371
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide

  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
4). train and evaluate IF...
  FutureWarning)
IF Training time for case uSc1C2_z-score  =  1.6735680103302002
x_norm_train.shape: (41881, 16)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.0495619773864746
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 16)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.1532139778137207
[[20401 15552]
 [ 1135 10832]]
tpr (recall): 0.5674352627040858, fnr: 0.4325647372959141, fpr: 0.09484415475892037, tnr: 0.9051558452410796, acc: 0.6517737896494157
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_16_features_ROC.pdf

---num_sub_features:17, they are [0, 1, 2, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 20, 21, 23, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 17), x_attack_train:0
x_norm_val:(5984, 17), x_attack_val:0
x_norm_test:(11967, 17), x_attack_test:(35953, 17)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 17)
AE training for Case :  uSc1C2_z-score  =  232.6410050392151 s
Train Loss =  0.05862449113299061 model.metrics_names ['loss']
Validation Loss =  0.05884044380350546 model.metrics_names ['loss']
training_losses:{'val_loss': [0.30381889856435396, 0.24750253056141144, 0.21727087488148938, 0.19500229814473322, 0.17613552450974357, 0.16633460606961326, 0.15256405737310808, 0.1507767717388862, 0.14040413467004337, 0.14127447878453822, 0.13005615209035057, 0.1310377574381344, 0.1350146776294326, 0.12219834773935737, 0.1283317329810265, 0.11922532487361827, 0.11323646790681675, 0.11307156695560976, 0.10734991669495475, 0.1262898626015148, 0.10496914022188773, 0.10411390040647538, 0.10043538867789793, 0.09788357410679527, 0.09681947222527336, 0.09120244656335862, 0.09434305143388197, 0.09578979688691583, 0.09124822348834359, 0.08767663836877614, 0.09869974277873728, 0.08320453765000252, 0.08591729075832163, 0.08233445249298676, 0.0827594971593051, 0.08047060266057438, 0.07776952622567906, 0.08654593949250997, 0.08235066635085937, 0.09293951430821164, 0.07904625180013039, 0.07683723364124961, 0.07251395992337063, 0.07284049410871006, 0.06922812979010974, 0.06870028984180108, 0.07240419420488378, 0.07135184402054644, 0.07558415640882629, 0.07074937250285862, 0.06941104785882853, 0.11122362741971398, 0.06837319564771525, 0.06944547531837449, 0.07359526386076116, 0.06815125528264811, 0.06950745048290267, 0.07906153788142663, 0.06463074971010341, 0.06860729565913665, 0.0671768695873054, 0.0705648645121146, 0.08003086417435325, 0.06861273892582419, 0.06346097747909832, 0.06811513446948746, 0.07061738202119255, 0.06618213075845637, 0.06646332238367535, 0.0645053744077045, 0.0669164896449622, 0.07094459719756707, 0.06460803133599899, 0.06875415381422655, 0.06381981140550445, 0.06851423834575052, 0.06634500194440551, 0.06147784781567553, 0.06549424004745993, 0.05984185223671842, 0.060204840051060055, 0.06522617471170299, 0.06524575360238871, 0.09787213601132128, 0.06204562849380116, 0.061566636125671675, 0.07800246743276157, 0.06059536268127793, 0.06015201313371327, 0.06338727593740677, 0.06537744444720248, 0.07655956000488072, 0.058295012954722114, 0.06006767150552515, 0.06115362378843328, 0.05616371037767214, 0.06268708893959535, 0.06278736530778242, 0.05971900437445564, 0.05884044380350546], 'loss': [0.6908396776861739, 0.27902255501954004, 0.2339933260388288, 0.20991500046989506, 0.19095071545267672, 0.17458572312280443, 0.1625152644699412, 0.15350174503134742, 0.14742506537776356, 0.14137210852259116, 0.13702327297938502, 0.13244969004377824, 0.12943633812375183, 0.126195965267216, 0.12344767395098752, 0.12078365651836243, 0.11737127177651571, 0.11589118503646977, 0.11361783427329941, 0.11113134460796222, 0.11000303395706416, 0.10771232885854602, 0.1046897072486181, 0.10289252018933366, 0.10056740089275017, 0.09758383594119774, 0.09633560609015963, 0.09360436706990022, 0.09251880785028942, 0.0903578303671251, 0.08906615668639267, 0.08748761667887975, 0.08595259218708182, 0.08409974250843467, 0.08408642773633244, 0.0822094490316706, 0.08204455982695971, 0.08028029199929879, 0.07939795157517789, 0.07905089270138234, 0.07851380164882253, 0.07718822149673399, 0.07623700535601814, 0.07621580337165053, 0.0755214580443219, 0.07501944884757838, 0.07537731897333273, 0.07407355904822883, 0.07398111243560135, 0.07240108265202264, 0.07336626333495397, 0.07280832895450619, 0.07161497088277588, 0.07173540773468946, 0.07076657220414548, 0.07195348847989312, 0.07050911496552358, 0.07067611635112708, 0.06956743257802626, 0.06929932819128204, 0.06942361993910189, 0.06929918628290326, 0.0698537509944004, 0.06911696057720156, 0.06800631685434401, 0.06841268570699766, 0.06720505517634077, 0.06805579270093452, 0.06749707943790123, 0.0678794444538097, 0.0671239695627059, 0.06635040755686032, 0.06671951154986051, 0.0660729316420335, 0.06630704436959187, 0.0659905486695675, 0.06602700146245642, 0.06516628526369106, 0.06520442426505686, 0.0656437021384753, 0.06524901645326693, 0.06338701781192956, 0.06471727211380132, 0.06428383477383534, 0.0661791021223624, 0.06390671060405428, 0.0633185450768181, 0.06405464870974092, 0.06345989716492491, 0.06316499170757821, 0.06313821387438681, 0.06356271765342511, 0.06269240323526636, 0.06244403093470472, 0.06232474602125387, 0.06302018039678708, 0.062399239426874614, 0.06210139085463323, 0.06091729950856529, 0.062060433277688926]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 17)
AE Test time for  uSc1C2_z-score  = :  2.1972901821136475
[[    0     0]
 [   50 41831]]
tpr (recall): 0, fnr: 0, fpr: 0.0011938587903822736, tnr: 0.9988061412096177, acc: 0.9988061412096177

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 17), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  2.308820962905884
[[32222  3731]
 [   21 11946]]
tpr (recall): 0.8962256279030957, fnr: 0.1037743720969043, fpr: 0.0017548257708698922, tnr: 0.9982451742291301, acc: 0.9217028380634391

save the FPR and FNR reausts of AE with num =17 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_17_features
*the maximize reconstrcution error is 10.155156445603202 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_17_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 10.155156445603202 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 75.18207830630455 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_17_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 75.18207830630455 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 17 features.
*** idx: 0,  thres = 0.0124206295913557
AE Test time for  uSc1C2_z-score  = :  1.6650259494781494
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0062103147956778
AE Test time for  uSc1C2_z-score  = :  2.0290040969848633
[[32209  3744]
 [   21 11946]]
tpr (recall): 0.8958640447250578, fnr: 0.10413595527494228, fpr: 0.0017548257708698922, tnr: 0.9982451742291301, acc: 0.9214315525876461
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  1.1563029289245605
[[30411  5542]
 [    3 11964]]
tpr (recall): 0.8458543097933413, fnr: 0.1541456902066587, fpr: 0.000250689395838556, tnr: 0.9997493106041614, acc: 0.8842863105175293
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_17_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
PCA Training time for case uSc1C2_z-score  =  0.058019161224365234
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
x_test.shape: (47920, 17)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
PCA Testing Time :  0.035356998443603516
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  1.5726940631866455
x_norm_train.shape: (41881, 17)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.9233472347259521
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 17)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.0697197914123535
[[20297 15656]
 [ 1178 10789]]
tpr (recall): 0.564542597279782, fnr: 0.43545740272021805, fpr: 0.09843736943260634, tnr: 0.9015626305673937, acc: 0.6487061769616027
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_17_features_ROC.pdf

---num_sub_features:18, they are [0, 1, 2, 3, 4, 6, 7, 8, 9, 10, 11, 14, 16, 18, 20, 21, 23, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 18), x_attack_train:0
x_norm_val:(5984, 18), x_attack_val:0
x_norm_test:(11967, 18), x_attack_test:(35953, 18)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 18)
AE training for Case :  uSc1C2_z-score  =  240.2413833141327 s
Train Loss =  0.06129321017363748 model.metrics_names ['loss']
Validation Loss =  0.06101653465931428 model.metrics_names ['loss']
training_losses:{'val_loss': [0.3612966698440001, 0.27596593078444986, 0.2389369305362676, 0.21394572207793833, 0.19745873616022222, 0.18692910774825092, 0.1713052039398229, 0.16731179971745944, 0.15719604169461818, 0.15331502461975272, 0.15032073596422685, 0.14397595759062842, 0.1415780777520037, 0.13779837550485835, 0.13740599553852795, 0.1476771097211914, 0.1304827031286005, 0.13027822867753033, 0.12540388190969426, 0.12836755274291983, 0.12554687803441827, 0.1210039455224486, 0.12378960867775952, 0.12241122126579285, 0.11831731795467795, 0.12008626149459319, 0.12061089472496574, 0.11611994049128364, 0.1097260643454159, 0.11533912275245482, 0.10845104144776568, 0.11898822564492251, 0.10925694415594804, 0.1040651245032721, 0.10788517070804687, 0.10349892290996358, 0.10276394247769673, 0.103671807735999, 0.09831779288815305, 0.10038214750627783, 0.09548534217843398, 0.09626564596665096, 0.09523172507231886, 0.08836877856025084, 0.09435661764626196, 0.0862431333146312, 0.09211586122923994, 0.09085015880870309, 0.08713495089886661, 0.08510141512926887, 0.08405493773559836, 0.07948538838303025, 0.09140312097926828, 0.08811296371215167, 0.08439254525670394, 0.07958994038841304, 0.07494019396244524, 0.0783570285109594, 0.0778953420486361, 0.07960456026030734, 0.07076234360509377, 0.07536859886053411, 0.07806808298284357, 0.07299602380331187, 0.0715187438390153, 0.07271749366891575, 0.10247656157150625, 0.0715803396215732, 0.06993036541868658, 0.07579764367185812, 0.07212438946340811, 0.07601646740328181, 0.07454684137660551, 0.06948542525184984, 0.06563094200536529, 0.08300877380418904, 0.07618482821287319, 0.08024317285115706, 0.06737019798972389, 0.06782221578977962, 0.07004436207088557, 0.06587176919381886, 0.0629184818204074, 0.07112355253355389, 0.06556064326734466, 0.06846375311201906, 0.07474103145659926, 0.06284843102336567, 0.06571425471634151, 0.06150902405301517, 0.061570446619534876, 0.0728166971136542, 0.0622631131327726, 0.06567804618952747, 0.05905476754361933, 0.06287871111921448, 0.06532316230596068, 0.06870728394484775, 0.06323616583159263, 0.06101653465931428], 'loss': [0.7952340566895075, 0.3263985979052801, 0.2678366387248486, 0.23668786603910716, 0.21582463182008516, 0.2000666118414473, 0.1866993774542941, 0.17750381471784496, 0.1696079631344995, 0.16468789386648505, 0.15891006667246912, 0.15437015097468487, 0.15102837904400027, 0.1471933624381274, 0.1449019391820753, 0.1422208663361601, 0.1404013287878484, 0.13676290917438103, 0.13533094910096793, 0.13338598872794596, 0.13152035009016755, 0.13048756331211062, 0.12800033927029272, 0.12614982167078248, 0.12537864133488275, 0.12407668205763309, 0.12184357300174091, 0.12044748280903907, 0.11891194161802686, 0.11790898709721462, 0.11611050059021107, 0.1139957911141756, 0.11276569059611631, 0.11220418708993787, 0.11077023823612903, 0.10851896573925043, 0.10682025638059099, 0.10546937894847923, 0.10354736433244703, 0.10276905238373636, 0.10073383371247076, 0.09860910777486369, 0.09816515943292235, 0.09556092011723903, 0.09506792907186869, 0.09361799640714837, 0.09295989199432124, 0.09222149605803667, 0.09049505909728228, 0.08946812784865907, 0.08808221504818399, 0.08733710002315377, 0.08612950208347227, 0.08592558787854879, 0.08457314261744066, 0.08341142005747179, 0.0829757143103145, 0.08171110811185502, 0.08067050571798132, 0.07991693117145578, 0.0797590444104228, 0.07840947598213226, 0.07757360617544369, 0.07709678317958796, 0.07657561205891984, 0.07640581645795733, 0.07625832094266022, 0.07655154528335013, 0.0754324868579372, 0.0751023782754163, 0.07459672379214341, 0.07440489930479909, 0.07376593981028123, 0.07507263488441529, 0.0721064750528097, 0.07332076676045268, 0.07199089418302301, 0.07110785168875869, 0.07123264998986714, 0.07081217439397566, 0.0704434793811183, 0.07006833716993578, 0.07022632877813056, 0.06914399944373724, 0.06857821907934311, 0.06879362377687971, 0.0678149977352153, 0.06806177053233989, 0.06658509612298337, 0.06740222562560151, 0.06696652346479555, 0.06589976197517304, 0.06530272768211895, 0.06577383164692761, 0.06498956301408938, 0.06511767777372109, 0.06472687539681787, 0.06417990350127448, 0.06413026362174018, 0.06332875797471456]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 18)
AE Test time for  uSc1C2_z-score  = :  1.148766040802002
[[    0     0]
 [   93 41788]]
tpr (recall): 0, fnr: 0, fpr: 0.0022205773501110288, tnr: 0.997779422649889, acc: 0.997779422649889

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 18), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  1.2266466617584229
[[31028  4925]
 [   31 11936]]
tpr (recall): 0.8630156037048369, fnr: 0.13698439629516312, fpr: 0.0025904570903317456, tnr: 0.9974095429096682, acc: 0.8965776293823038

save the FPR and FNR reausts of AE with num =18 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_18_features
*the maximize reconstrcution error is 9.882985923906231 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_18_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 9.882985923906231 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 102.71043223168402 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_18_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 102.71043223168402 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 18 features.
*** idx: 0,  thres = 0.005953732565039083
AE Test time for  uSc1C2_z-score  = :  1.2691700458526611
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0029768662825196
AE Test time for  uSc1C2_z-score  = :  1.1670567989349365
[[31020  4933]
 [   31 11936]]
tpr (recall): 0.8627930909798904, fnr: 0.1372069090201096, fpr: 0.0025904570903317456, tnr: 0.9974095429096682, acc: 0.8964106844741235
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  1.1733908653259277
[[30490  5463]
 [    5 11962]]
tpr (recall): 0.8480516229521876, fnr: 0.15194837704781242, fpr: 0.0004178156597309267, tnr: 0.999582184340269, acc: 0.8858931552587646
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_18_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
PCA Training time for case uSc1C2_z-score  =  0.05356740951538086
x_test.shape: (47920, 18)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
PCA Testing Time :  0.03175806999206543
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  1.6219630241394043
x_norm_train.shape: (41881, 18)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  0.9574787616729736
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 18)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.1500542163848877
[[19351 16602]
 [ 1135 10832]]
tpr (recall): 0.5382304675548633, fnr: 0.4617695324451367, fpr: 0.09484415475892037, tnr: 0.9051558452410796, acc: 0.6298622704507513
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_18_features_ROC.pdf

---num_sub_features:21, they are [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 21, 22, 23, 24]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 21), x_attack_train:0
x_norm_val:(5984, 21), x_attack_val:0
x_norm_test:(11967, 21), x_attack_test:(35953, 21)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 21)
AE training for Case :  uSc1C2_z-score  =  239.6460108757019 s
Train Loss =  0.08214431343501999 model.metrics_names ['loss']
Validation Loss =  0.08095479206764762 model.metrics_names ['loss']
training_losses:{'val_loss': [0.42369752277664957, 0.3150510725809291, 0.27776781027329794, 0.24607446825599924, 0.22681947638166142, 0.21666691627572565, 0.21677923744375055, 0.22210164698846838, 0.19576082342767462, 0.19080776988185025, 0.18958372782099056, 0.180982022282274, 0.18059978725757192, 0.1808965341611342, 0.17527017176629386, 0.17532193031221788, 0.16780585082457028, 0.16714581341188858, 0.16275374001678936, 0.16732321376787787, 0.15967195827693226, 0.15560478258897914, 0.15862014335903893, 0.15552586372842125, 0.15121669214677047, 0.15255759600649543, 0.15024869004513491, 0.15172936731481299, 0.14814890383239737, 0.14610604722710216, 0.14416996409548796, 0.1474260096961164, 0.14943554786277966, 0.1394985003028324, 0.14452142328183282, 0.14123353903943842, 0.1352193197384875, 0.14371582817903814, 0.13732291204247246, 0.13735463490141905, 0.13829882387171455, 0.13235952633428064, 0.13389647763999388, 0.13439962933248378, 0.13280854286516414, 0.12935961639498644, 0.12723785055113987, 0.13053799914644365, 0.128183841984221, 0.12582668307471404, 0.12334086929253715, 0.13449602617936976, 0.11917180502239395, 0.12317070245424057, 0.12331469090067766, 0.1263675392869322, 0.11873688367519149, 0.11658902151540002, 0.13553531942042438, 0.11617363523193859, 0.11868716700669917, 0.11538958306459182, 0.11721307367962949, 0.11368426841927722, 0.11879486383441935, 0.11599724132189139, 0.10954658860430361, 0.11596932493269763, 0.11340484845845457, 0.1104302421252039, 0.11941243809732524, 0.11106097835668906, 0.10724811479050846, 0.10593969490438859, 0.10682837573442867, 0.11064012462203515, 0.10827657303469067, 0.10573071087984477, 0.10743851796350377, 0.10666947441305069, 0.09928558137327592, 0.10212993141721914, 0.10055866020726648, 0.09655670516870239, 0.09999413676759139, 0.09244767646180754, 0.08928875240651682, 0.09041731776719425, 0.08923534200312619, 0.09354431803691833, 0.08621423085902465, 0.08798700664690472, 0.08700834804358967, 0.08884235907764358, 0.08041072184628344, 0.09039741439774712, 0.08363678860154382, 0.07695482553724936, 0.0779565057572834, 0.08095479206764762], 'loss': [0.9334114073749225, 0.3875891763438258, 0.3175020668232146, 0.28207058124198847, 0.25687561082534266, 0.2396851141145494, 0.22750304922091835, 0.21959773786091133, 0.21350101619195336, 0.20748199178901483, 0.20259148083771855, 0.1981842305715553, 0.19373900174083428, 0.1892316204112067, 0.18648856789544707, 0.18266006080461167, 0.17983833123368062, 0.17707234167174707, 0.17423403078504224, 0.17095526749028145, 0.16974966676348882, 0.16666296512295536, 0.1635831360869998, 0.1623693938648794, 0.1604618422624967, 0.15862836513046275, 0.1565521613376444, 0.1551615659838015, 0.15341848334525826, 0.15197736661769934, 0.15045686163034364, 0.1490323705984441, 0.14814121217060014, 0.14643816815359692, 0.14540470664889038, 0.1447329505943944, 0.14350680857829204, 0.14210215223082892, 0.14047535955486073, 0.13990120716557194, 0.13933437088209255, 0.13744059032564537, 0.13697312119456498, 0.1353528792380259, 0.1345414470124531, 0.13348706929915835, 0.1322926405205921, 0.13115085387055722, 0.13076979011533477, 0.1282730719027864, 0.12871467409263762, 0.12744321351026452, 0.1262517547561026, 0.1251324756484453, 0.12510885351123635, 0.12407207917216138, 0.12361059422658754, 0.12246267780540968, 0.12157689156408129, 0.12105075265952582, 0.12026405880319614, 0.1197231550799941, 0.11889571772375909, 0.11848811267602438, 0.11772789261490302, 0.11710984025711185, 0.11666862820489385, 0.11612667730410994, 0.1157487117218193, 0.11469149191489958, 0.11382818931203975, 0.11343246616012362, 0.11239024347177747, 0.11270783311222404, 0.1111616825386969, 0.11079714691870785, 0.10978344192827179, 0.10897222316491963, 0.10815972458729614, 0.10715057998532732, 0.10576296009941483, 0.10512874862316364, 0.1035507498171367, 0.09983330526663835, 0.09737892208311762, 0.09647392785968151, 0.0949099938390103, 0.09328404865559976, 0.09268703947990256, 0.09119234808102962, 0.09051945426714078, 0.09011171367117704, 0.08823082644007346, 0.087438662960264, 0.086324301108603, 0.08494409461869759, 0.08525742040026231, 0.08351923170692101, 0.08332090291537363, 0.08213062650880967]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 21)
AE Test time for  uSc1C2_z-score  = :  1.458765983581543
[[    0     0]
 [  209 41672]]
tpr (recall): 0, fnr: 0, fpr: 0.004990329743797903, tnr: 0.9950096702562021, acc: 0.9950096702562021

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 21), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  1.4580159187316895
[[32933  3020]
 [   69 11898]]
tpr (recall): 0.9160014463327122, fnr: 0.08399855366728785, fpr: 0.005765856104286789, tnr: 0.9942341438957132, acc: 0.9355383973288814

save the FPR and FNR reausts of AE with num =21 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_21_features
*the maximize reconstrcution error is 16.29904080740145 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_21_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 16.29904080740145 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 125.55794795956035 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_21_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 125.55794795956035 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 21 features.
*** idx: 0,  thres = 0.010625813897257218
AE Test time for  uSc1C2_z-score  = :  1.453542947769165
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0053129069486286
AE Test time for  uSc1C2_z-score  = :  1.5044889450073242
[[32925  3028]
 [   69 11898]]
tpr (recall): 0.9157789336077657, fnr: 0.08422106639223431, fpr: 0.005765856104286789, tnr: 0.9942341438957132, acc: 0.9353714524207012
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  1.421522855758667
[[30654  5299]
 [    9 11958]]
tpr (recall): 0.8526131338135899, fnr: 0.14738686618641003, fpr: 0.0007520681875156681, tnr: 0.9992479318124843, acc: 0.8892320534223707
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_21_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:265: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/numpy/lib/function_base.py:4406: RuntimeWarning: invalid value encountered in multiply
  x2 = take(ap, indices_above, axis=axis) * weights_above
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:360: RuntimeWarning: invalid value encountered in greater
  self.labels_ = (self.decision_scores_ > self.threshold_).astype(
/usr/local/lib/python3.6/site-packages/numpy/core/_methods.py:112: RuntimeWarning: invalid value encountered in subtract
  x = asanyarray(arr - arrmean)
PCA Training time for case uSc1C2_z-score  =  0.08333015441894531
x_test.shape: (47920, 21)
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide
  cdist(X, self.selected_components_) / self.selected_w_components_,
PCA Testing Time :  0.03596782684326172
/usr/local/lib/python3.6/site-packages/pyod/models/base.py:163: RuntimeWarning: invalid value encountered in greater
  return (pred_score > self.threshold_).astype('int').ravel()
[[    0 35953]
 [    0 11967]]
tpr (recall): 0.0, fnr: 1.0, fpr: 0.0, tnr: 1.0, acc: 0.249728714524207
/usr/local/lib/python3.6/site-packages/pyod/models/pca.py:296: RuntimeWarning: divide by zero encountered in true_divide

4). train and evaluate IF...
  cdist(X, self.selected_components_) / self.selected_w_components_,
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)
IF Training time for case uSc1C2_z-score  =  1.9288461208343506
x_norm_train.shape: (41881, 21)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.0491399765014648
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 21)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.1095929145812988
[[20263 15690]
 [ 1159 10808]]
tpr (recall): 0.5635969181987595, fnr: 0.4364030818012405, fpr: 0.09684966992562881, tnr: 0.9031503300743712, acc: 0.6483931552587646
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_21_features_ROC.pdf

---num_sub_features:27, they are [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26]
select the corresponding features data.
**all_norm:59832, all_attack:35953
x_norm_train:(41881, 27), x_attack_train:0
x_norm_val:(5984, 27), x_attack_val:0
x_norm_test:(11967, 27), x_attack_test:(35953, 27)

Step 3. train and evaluate AE on case: uSc1C2_z-score

Step 3-1. train AE on case: uSc1C2_z-score
x_norm_train.shape: (41881, 27)
AE training for Case :  uSc1C2_z-score  =  236.2612500190735 s
Train Loss =  0.13161661559206855 model.metrics_names ['loss']
Validation Loss =  0.12832676037588223 model.metrics_names ['loss']
training_losses:{'val_loss': [0.5056722533894095, 0.3874781393112346, 0.3615412317654666, 0.31817183153514556, 0.2989803734310171, 0.2785128441883281, 0.2692481717642616, 0.2624884524288025, 0.2632516185867595, 0.25383431974419934, 0.24563985325914015, 0.23768949986779117, 0.2342073793079764, 0.22395526781120403, 0.22132186691231906, 0.21926812042686392, 0.21434672603154564, 0.21510972373466442, 0.2058422910099361, 0.20128666828660405, 0.20411944516839828, 0.18799506900782254, 0.1958368263222317, 0.19042176199469338, 0.18674708731512335, 0.18349596515377575, 0.17914533886042508, 0.18452885276812284, 0.17850192871323245, 0.1792476946179242, 0.17009158101789454, 0.17269778128135652, 0.17404278471348758, 0.1733721300242419, 0.16475562520205655, 0.16975106697350262, 0.17130105376721702, 0.163725990941499, 0.16421136981185108, 0.15982665276941768, 0.1597011792149773, 0.1770149540694002, 0.15851623891668523, 0.1625745635141026, 0.15993648157878357, 0.16345430954414256, 0.15687444626806893, 0.16962760344227368, 0.15331855173257583, 0.15931953135180602, 0.1568372671138794, 0.15273576285590462, 0.15654743542486332, 0.15736584544659935, 0.1484916346038089, 0.15429860122382322, 0.14803403639857143, 0.14317127285316028, 0.1461939304509265, 0.1582126887166564, 0.14713080243312102, 0.1416848025379334, 0.14535059154352403, 0.1458913615361892, 0.1430878973899678, 0.14000792132023185, 0.14871725467915203, 0.14079421133121706, 0.13912704865881467, 0.1544893066035235, 0.13640610658548732, 0.14168380977795086, 0.1340999373379238, 0.14195971366237192, 0.13665879505840853, 0.13933108101554095, 0.14293775707483292, 0.1356795050482699, 0.13589956324527608, 0.1395633555351094, 0.14120067189880872, 0.1329234334475854, 0.13213236155835065, 0.1358258664448631, 0.13851462248812385, 0.1403171944825407, 0.13496244579234862, 0.13733891314044994, 0.13615014200860803, 0.1363546323569063, 0.1465316182550262, 0.1327763929325629, 0.13141874550657476, 0.1282169828838843, 0.1333036128292109, 0.12804396647740812, 0.12829463865189628, 0.12919756068902857, 0.1273634099466278, 0.12832676037588223], 'loss': [1.1402593980799067, 0.4604053565374985, 0.3891003268183207, 0.353894888389071, 0.3283027917963594, 0.3061478294211391, 0.2923214398133248, 0.28155207226761764, 0.2733007268770892, 0.2667617920309996, 0.2603526378095766, 0.25449308915613134, 0.24842720195789458, 0.24276138563907687, 0.23739319497442374, 0.23254098014900312, 0.2272958697654699, 0.22224959299305966, 0.21674284613413414, 0.21311660160014964, 0.20899587965851849, 0.20567098312797372, 0.20244573792451798, 0.19987872607975934, 0.19723904784237348, 0.19491832036533818, 0.1914448286334758, 0.18931071569441338, 0.1876919101152068, 0.1849794551327749, 0.18363141953028625, 0.18167885896269, 0.18034999449092376, 0.17847235208809403, 0.1770547276131019, 0.17595358570742203, 0.17466853579048588, 0.1733969734720456, 0.17231599192875385, 0.1710769099183981, 0.16959963857647978, 0.16964244682135718, 0.1676901396998094, 0.16701525895745156, 0.16610629095126125, 0.16603429410273507, 0.16414471305934347, 0.16328729309840956, 0.16252485491755767, 0.16165330486336488, 0.16073080642366644, 0.1602244113187747, 0.15907645341372617, 0.15862668618381584, 0.15772689608036256, 0.15621814923706734, 0.15593876854033192, 0.15524646461907302, 0.1536954997250106, 0.15408216586551263, 0.1530787579097765, 0.15175677568203585, 0.15151814775551342, 0.14973914013387754, 0.14965395875368886, 0.14944057562952753, 0.1482314715036812, 0.1480012791933219, 0.14713725678469552, 0.14668079056300268, 0.14671941461689433, 0.1452954624097525, 0.14512876163562285, 0.14441535247066456, 0.14393065385016116, 0.14380323408359083, 0.14294724366209238, 0.14234743883948434, 0.14247621630478638, 0.14135826020897047, 0.14145976595321025, 0.1411903922307022, 0.14074504081782388, 0.14023124687812158, 0.14012277602974363, 0.1390476906497557, 0.13877480170984147, 0.13861415709712518, 0.13796640942059765, 0.13788745080816156, 0.13741468241129304, 0.13739731049660622, 0.13693652655565078, 0.13607317821375833, 0.13635144890705314, 0.13566913640063477, 0.135287889506046, 0.13492237291192088, 0.135705219966296, 0.13508434975288286]}
using the presetted threshold
optimal_thres_AE_val:1.0, factor = None, key = None
Test AE on train set on case: uSc1C2_z-score
x_norm_train.shape: (41881, 27)
AE Test time for  uSc1C2_z-score  = :  1.3721108436584473
[[    0     0]
 [  687 41194]]
tpr (recall): 0, fnr: 0, fpr: 0.016403619779852437, tnr: 0.9835963802201476, acc: 0.9835963802201476

Step 3-2. evaluate AE on case: uSc1C2_z-score

1). evaluate AE on test set:
x_test.shape: (47920, 27), case: uSc1C2_z-score
optimal_thres_AE 1.0 achieved from key=None, factor = None, key = None
AE Test time for  uSc1C2_z-score  = :  1.4725761413574219
[[33654  2299]
 [  217 11750]]
tpr (recall): 0.9360554056685116, fnr: 0.06394459433148833, fpr: 0.018133199632322218, tnr: 0.9818668003676778, acc: 0.9474958263772955

save the FPR and FNR reausts of AE with num =27 features on test set.
output_pre_path:uSc1C2_z-score_recon_err_of_27_features
*the maximize reconstrcution error is 13.76345030416876 for Reconstruction loss of normal samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_27_features_reconstruct_loss_normal_data_rescon.pdf
*the maximize reconstrcution error is 13.76345030416876 for Reconstruction loss of normal samples in samples' order
*the maximize reconstrcution error is 99.2004113743025 for Reconstruction loss of attack samples
Reconstr: out_file:Figures/uSc1C2_z-score_recon_err_of_27_features_reconstruct_loss_attack_data_rescon.pdf
*the maximize reconstrcution error is 99.2004113743025 for Reconstruction loss of attack samples in samples' order

-Evaluate AE with different thresholds on test set with num = 27 features.
*** idx: 0,  thres = 0.010859128689233034
AE Test time for  uSc1C2_z-score  = :  1.5220777988433838
[[35953     0]
 [11967     0]]
tpr (recall): 1.0, fnr: 0.0, fpr: 1.0, tnr: 0.0, acc: 0.750271285475793
*** idx: 1,  thres = 1.0054295643446165
AE Test time for  uSc1C2_z-score  = :  1.5102059841156006
[[33654  2299]
 [  207 11760]]
tpr (recall): 0.9360554056685116, fnr: 0.06394459433148833, fpr: 0.017297568312860365, tnr: 0.9827024316871397, acc: 0.9477045075125209
*** idx: 2,  thres = 2.0
AE Test time for  uSc1C2_z-score  = :  1.725342035293579
[[32135  3818]
 [   64 11903]]
tpr (recall): 0.8938058020193029, fnr: 0.10619419798069703, fpr: 0.005348040444555862, tnr: 0.9946519595554442, acc: 0.9189899833055092
AE_thres: out_file:Figures/uSc1C2_z-score_thres_res_metrics_of_27_features_AE_thres.pdf

2). no need to evaluate DT on test set

3). train and evaluate PCA...
PCA Training time for case uSc1C2_z-score  =  0.10507702827453613
x_test.shape: (47920, 27)
PCA Testing Time :  0.05470895767211914
[[35953     0]
 [ 1150 10817]]
tpr (recall): 1.0, fnr: 0.0, fpr: 0.09609760173811314, tnr: 0.9039023982618869, acc: 0.9760016694490818
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:213: FutureWarning: default contamination parameter 0.1 will change in version 0.22 to "auto". This will change the predict method behavior.
  FutureWarning)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:223: FutureWarning: behaviour="old" is deprecated and will be removed in version 0.22. Please use behaviour="new", which makes the decision_function change to match other anomaly detection algorithm API.
  FutureWarning)

4). train and evaluate IF...
IF Training time for case uSc1C2_z-score  =  2.5678908824920654
x_norm_train.shape: (41881, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.1361651420593262
[[    0     0]
 [ 4188 37693]]
tpr (recall): 0, fnr: 0, fpr: 0.09999761228241924, tnr: 0.9000023877175808, acc: 0.9000023877175808
x_test.shape: (47920, 27)
/usr/local/lib/python3.6/site-packages/sklearn/ensemble/iforest.py:417: DeprecationWarning: threshold_ attribute is deprecated in 0.20 and will be removed in 0.22.
  " be removed in 0.22.", DeprecationWarning)
IF Testing Time :  1.3782150745391846
[[17649 18304]
 [ 1149 10818]]
tpr (recall): 0.49089088532250436, fnr: 0.5091091146774956, fpr: 0.09601403860616696, tnr: 0.903985961393833, acc: 0.5940525876460768
key:DT, value:[]
key:PCA, value:[]
key:OCSVM, value:[]
ROC:out_file:Figures/uSc1C2_z-score_roc_data_of_27_features_ROC.pdf
Num_features: out_file:Figures/uSc1C2_z-score_num_features_res_metrics_num_features.pdf

Process finished with exit code 0
